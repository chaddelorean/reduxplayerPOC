!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=6)}([function(e,t,r){"use strict";r.r(t),r.d(t,"__DO_NOT_USE__ActionTypes",(function(){return i})),r.d(t,"applyMiddleware",(function(){return b})),r.d(t,"bindActionCreators",(function(){return d})),r.d(t,"combineReducers",(function(){return s})),r.d(t,"compose",(function(){return h})),r.d(t,"createStore",(function(){return a}));var n=r(1),o=function(){return Math.random().toString(36).substring(7).split("").join(".")},i={INIT:"@@redux/INIT"+o(),REPLACE:"@@redux/REPLACE"+o(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+o()}};function c(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function a(e,t,r){var o;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(a)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var u=e,s=t,l=[],d=l,p=!1;function f(){d===l&&(d=l.slice())}function y(){if(p)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return s}function h(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(p)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribelistener for more details.");var t=!0;return f(),d.push(e),function(){if(t){if(p)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribelistener for more details.");t=!1,f();var r=d.indexOf(e);d.splice(r,1),l=null}}}function b(e){if(!c(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(p)throw new Error("Reducers may not dispatch actions.");try{p=!0,s=u(s,e)}finally{p=!1}for(var t=l=d,r=0;r<t.length;r++){(0,t[r])()}return e}function m(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");u=e,b({type:i.REPLACE})}function w(){var e,t=h;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function r(){e.next&&e.next(y())}return r(),{unsubscribe:t(r)}}})[n.a]=function(){return this},e}return b({type:i.INIT}),(o={dispatch:b,subscribe:h,getState:y,replaceReducer:m})[n.a]=w,o}function u(e,t){var r=t&&t.type;return"Given "+(r&&'action "'+String(r)+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function s(e){for(var t=Object.keys(e),r={},n=0;n<t.length;n++){var o=t[n];0,"function"==typeof e[o]&&(r[o]=e[o])}var c,a=Object.keys(r);try{!function(e){Object.keys(e).forEach((function(t){var r=e[t];if(void 0===r(void 0,{type:i.INIT}))throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===r(void 0,{type:i.PROBE_UNKNOWN_ACTION()}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+i.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(r)}catch(e){c=e}return function(e,t){if(void 0===e&&(e={}),c)throw c;for(var n=!1,o={},i=0;i<a.length;i++){var s=a[i],l=r[s],d=e[s],p=l(d,t);if(void 0===p){var f=u(s,t);throw new Error(f)}o[s]=p,n=n||p!==d}return(n=n||a.length!==Object.keys(e).length)?o:e}}function l(e,t){return function(){return t(e.apply(this,arguments))}}function d(e,t){if("function"==typeof e)return l(e,t);if("object"!=typeof e||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');var r={};for(var n in e){var o=e[n];"function"==typeof o&&(r[n]=l(o,t))}return r}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e,t){var r=Object.keys(e);return Object.getOwnPropertySymbols&&r.push.apply(r,Object.getOwnPropertySymbols(e)),t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(r,!0).forEach((function(t){p(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function b(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),n=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:r.getState,dispatch:function(){return n.apply(void 0,arguments)}},i=t.map((function(e){return e(o)}));return y({},r,{dispatch:n=h.apply(void 0,i)(r.dispatch)})}}}},function(e,t,r){"use strict";(function(e,n){var o,i=r(2);o="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:n;var c=Object(i.a)(o);t.a=c}).call(this,r(4),r(5)(e))},function(e,t,r){"use strict";function n(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}r.d(t,"a",(function(){return n}))},function(e,t,r){"use strict";var n=r(0).compose;t.__esModule=!0,t.composeWithDevTools="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"==typeof arguments[0]?n:n.apply(null,arguments)},t.devToolsEnhancer="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__?window.__REDUX_DEVTOOLS_EXTENSION__:function(){return function(e){return e}}},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,r){"use strict";r.r(t);const n="PLAYING",o="STOPPED",i="PAUSED",c="SEEKING",a="STALLED",u="ENDED",s="TIME_UPDATE",l="ABSOLUTE_TIME_UPDATE",d="SET_BEACON",p="CLEAR_BEACONS",f="PLAY_STATE",y="PAUSE_STATE",h="STALLED_STATE",b="SEEKING_STATE",m="STOPPED_STATE",w="NEXT_CLIP",v="PREV_CLIP",E="SWITCH_CLIP",T="CLIPLIST_UPDATE",O="CLIP_ENDED",g="defaultImpression",S="firstQuartile",_="midway",P="thirdQuartile",I="complete",j=e=>({type:l,payLoad:e}),L=()=>({type:h}),x=function(e){return 1e3*e};var A=r(0);let N=Object(A.combineReducers)({playerStateReducer:(e=o,t)=>{switch(t.type){case m:e=o;break;case f:e=n;break;case y:e=i;break;case h:e=a;break;case b:e=c;break;case O:e=u}return e},clipListReducer:(e={clipList:[],currentClipIndex:0},t)=>{switch(t.type){case w:e.currentClipIndex++;break;case v:e.currentClipIndex--;break;case E:e.currentClipIndex=t.clipIndex;break;case T:e=t.assetClipList}return e}});var k=r(3);const C=Object(k.composeWithDevTools)({realtime:!0}),D=Object(A.createStore)((e={apjsTime:0,playerTime:0,beacons:[]},t)=>{switch(t.type){case s:e.apjsTime+=t.msIncrement,e.playerTime=t.playerTime;break;case l:e.apjsTime=t.payLoad,e.playerTime=t.payLoad;break;case d:let r=e.beacons.findIndex(e=>e.type===t.payLoad.type&&e.timeIndex===t.payLoad.timeIndex);-1!==r?e.beacons.splice(r,t.payLoad):e.beacons.push(t.payLoad);break;case p:e.beacons=[]}return e},C()),R=Object(A.createStore)(N,C());var U=[g,S,_,P,I],M=[{url:"https://media.w3.org/2010/05/sintel/trailer.mp4"},{url:"http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4"},{url:"http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4"}];let B,X;function V(e){let t=R.getState();if(t.clipListReducer){let r=t.clipListReducer.currentClipIndex||0,n=t.clipListReducer.clipList,o=document.createElement("source");o.type="video/mp4",o.src=n[r].url,e.innerHTML="",e.appendChild(o),r>0&&(e.load(),setTimeout(()=>{e.play()},1e3))}}function W(){let e=D.getState().apjsTime,t=e/1e3,r=D.getState().playerTime;e%1e3==0&&0!==e&&console.log(`1 second interval happened! APJSTime: ${e} ms PlayerTime: ${r} sec`),t%30==0&&0!==e&&console.log(`30 second interval happened! APJSTime: ${t} sec PlayerTime: ${r} sec`),t%60==0&&0!==e&&console.log(`1 minute interval happened! APJSTime: ${t} sec PlayerTime: ${r} sec`),t%300==0&&0!==e&&console.log(`5 minute interval happened! APJSTime: ${t} sec PlayerTime: ${r} sec`)}$((function(){B=document.getElementById("sampleVideoPlayer"),B.onplay=()=>{!function(){let e=B.duration;U.map(t=>{let r=0;switch(t){case g:r=0;break;case S:r=.25*e;break;case _:r=e/2;break;case P:r=.75*e;break;case I:r=e}let n={type:t,timeIndex:x(r),isFired:!1};D.dispatch((e=>({type:d,payLoad:e}))(n))})}(),R.dispatch({type:f}),X=window.setInterval(()=>{let e=D.getState().playerTime,t=B.currentTime,r=R.getState().playerState;t-e>1e4&&r!==a&&(console.error("Stall detected"),R.dispatch(L())),D.dispatch({type:s,msIncrement:100,playerTime:t})},100)},B.onpause=()=>{R.dispatch({type:y}),clearInterval(X)},B.onstalled=()=>{R.dispatch(L())},B.onseeking=()=>{R.dispatch({type:b})},B.onseeked=e=>{var t;D.dispatch(j((t=x(B.currentTime),100*Math.ceil(t/100))))},B.onended=()=>{R.dispatch({type:O});let e=R.getState();if(e){(e.clipListReducer.currentClipIndex||0)+1<e.clipListReducer.clipList.length&&(D.dispatch(j(0)),D.dispatch({type:p}),R.dispatch({type:w}),V(B))}},R.dispatch({type:T,assetClipList:{clipList:M,currentClipIndex:0}}),V(B),D.subscribe(W)}))}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3JlZHV4L2VzL3JlZHV4LmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy9zeW1ib2wtb2JzZXJ2YWJsZS9lcy9pbmRleC5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMvc3ltYm9sLW9ic2VydmFibGUvZXMvcG9ueWZpbGwuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3JlZHV4LWRldnRvb2xzLWV4dGVuc2lvbi9pbmRleC5qcyIsIndlYnBhY2s6Ly8vKHdlYnBhY2spL2J1aWxkaW4vZ2xvYmFsLmpzIiwid2VicGFjazovLy8od2VicGFjaykvYnVpbGRpbi9oYXJtb255LW1vZHVsZS5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvdHlwZXMvcGxheWVyRW51bXMuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FjdGlvbnMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3V0aWxzLmpzIiwid2VicGFjazovLy8uL3NyYy9yZWR1Y2Vycy9pbmRleC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvc3RvcmUvaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3R5cGVzL2JlYWNvbnMuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL3R5cGVzL2NsaXBMaXN0LmpzIiwid2VicGFjazovLy8uL3NyYy9tYWluLmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwicmFuZG9tU3RyaW5nIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwic3BsaXQiLCJqb2luIiwiQWN0aW9uVHlwZXMiLCJJTklUIiwiUkVQTEFDRSIsIlBST0JFX1VOS05PV05fQUNUSU9OIiwiaXNQbGFpbk9iamVjdCIsIm9iaiIsInByb3RvIiwiZ2V0UHJvdG90eXBlT2YiLCJjcmVhdGVTdG9yZSIsInJlZHVjZXIiLCJwcmVsb2FkZWRTdGF0ZSIsImVuaGFuY2VyIiwiX3JlZjIiLCJhcmd1bWVudHMiLCJFcnJvciIsInVuZGVmaW5lZCIsImN1cnJlbnRSZWR1Y2VyIiwiY3VycmVudFN0YXRlIiwiY3VycmVudExpc3RlbmVycyIsIm5leHRMaXN0ZW5lcnMiLCJpc0Rpc3BhdGNoaW5nIiwiZW5zdXJlQ2FuTXV0YXRlTmV4dExpc3RlbmVycyIsInNsaWNlIiwiZ2V0U3RhdGUiLCJzdWJzY3JpYmUiLCJsaXN0ZW5lciIsImlzU3Vic2NyaWJlZCIsInB1c2giLCJpbmRleCIsImluZGV4T2YiLCJzcGxpY2UiLCJkaXNwYXRjaCIsImFjdGlvbiIsInR5cGUiLCJsaXN0ZW5lcnMiLCJsZW5ndGgiLCJyZXBsYWNlUmVkdWNlciIsIm5leHRSZWR1Y2VyIiwib2JzZXJ2YWJsZSIsIl9yZWYiLCJvdXRlclN1YnNjcmliZSIsIm9ic2VydmVyIiwiVHlwZUVycm9yIiwib2JzZXJ2ZVN0YXRlIiwibmV4dCIsInVuc3Vic2NyaWJlIiwidGhpcyIsImdldFVuZGVmaW5lZFN0YXRlRXJyb3JNZXNzYWdlIiwiYWN0aW9uVHlwZSIsIlN0cmluZyIsImNvbWJpbmVSZWR1Y2VycyIsInJlZHVjZXJzIiwicmVkdWNlcktleXMiLCJrZXlzIiwiZmluYWxSZWR1Y2VycyIsInNoYXBlQXNzZXJ0aW9uRXJyb3IiLCJmaW5hbFJlZHVjZXJLZXlzIiwiZm9yRWFjaCIsImFzc2VydFJlZHVjZXJTaGFwZSIsImUiLCJzdGF0ZSIsImhhc0NoYW5nZWQiLCJuZXh0U3RhdGUiLCJfaSIsIl9rZXkiLCJwcmV2aW91c1N0YXRlRm9yS2V5IiwibmV4dFN0YXRlRm9yS2V5IiwiZXJyb3JNZXNzYWdlIiwiYmluZEFjdGlvbkNyZWF0b3IiLCJhY3Rpb25DcmVhdG9yIiwiYXBwbHkiLCJiaW5kQWN0aW9uQ3JlYXRvcnMiLCJhY3Rpb25DcmVhdG9ycyIsImJvdW5kQWN0aW9uQ3JlYXRvcnMiLCJfZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJ3cml0YWJsZSIsIm93bktleXMiLCJlbnVtZXJhYmxlT25seSIsImdldE93blByb3BlcnR5U3ltYm9scyIsImZpbHRlciIsInN5bSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsIl9vYmplY3RTcHJlYWQyIiwidGFyZ2V0Iiwic291cmNlIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyIsImRlZmluZVByb3BlcnRpZXMiLCJjb21wb3NlIiwiX2xlbiIsImZ1bmNzIiwiQXJyYXkiLCJhcmciLCJyZWR1Y2UiLCJhIiwiYiIsImFwcGx5TWlkZGxld2FyZSIsIm1pZGRsZXdhcmVzIiwic3RvcmUiLCJfZGlzcGF0Y2giLCJtaWRkbGV3YXJlQVBJIiwiY2hhaW4iLCJtYXAiLCJtaWRkbGV3YXJlIiwicm9vdCIsInNlbGYiLCJ3aW5kb3ciLCJnbG9iYWwiLCJyZXN1bHQiLCJzeW1ib2xPYnNlcnZhYmxlUG9ueWZpbGwiLCJjb21wb3NlV2l0aERldlRvb2xzIiwiX19SRURVWF9ERVZUT09MU19FWFRFTlNJT05fQ09NUE9TRV9fIiwiZGV2VG9vbHNFbmhhbmNlciIsIl9fUkVEVVhfREVWVE9PTFNfRVhURU5TSU9OX18iLCJub29wIiwiZyIsIkZ1bmN0aW9uIiwib3JpZ2luYWxNb2R1bGUiLCJ3ZWJwYWNrUG9seWZpbGwiLCJjaGlsZHJlbiIsInBsYXllckVudW1zIiwicGxheWVyQWN0aW9ucyIsImJlYWNvblR5cGVzIiwic2V0QWJvc2x1dGVUaW1lbGluZSIsIm5ld1RpbWUiLCJwYXlMb2FkIiwic3RhbGxlZFN0YXRlIiwiY29udmVydFRvTWlsbGlzZWNvbmRzIiwidGltZSIsImFwSlNSZWR1Y2VycyIsInBsYXllclN0YXRlUmVkdWNlciIsInBsYXllclN0YXRlIiwiY2xpcExpc3RSZWR1Y2VyIiwiYXNzZXRDbGlwTGlzdCIsImNsaXBMaXN0IiwiY3VycmVudENsaXBJbmRleCIsImNsaXBJbmRleCIsImNvbXBvc2VFbmhhbmNlcnMiLCJyZWFsdGltZSIsInRpbWVsaW5lU3RvcmUiLCJ0aW1lT2JqZWN0IiwiYXBqc1RpbWUiLCJwbGF5ZXJUaW1lIiwiYmVhY29ucyIsIm1zSW5jcmVtZW50IiwiZmluZEluZGV4IiwiYmVhY29uIiwidGltZUluZGV4IiwiYXBqc1N0b3JlIiwidXJsIiwidGltZWxpbmVJbnRlcnZhbCIsImxvYWRWaWRlb1NyYyIsInNhbXBsZVZpZGVvUGxheWVyIiwiYXBqc1N0b3JlU3RhdGUiLCJjbGlwTGlzdEZyb21TdG9yZSIsInNvdXJjZUVsZW1lbnQiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJzcmMiLCJpbm5lckhUTUwiLCJhcHBlbmRDaGlsZCIsImxvYWQiLCJzZXRUaW1lb3V0IiwicGxheSIsIm9uVGltZVVwZGF0ZSIsImN1cnJlbnRBUEpTVGltZU1TIiwiY3VycmVudEFQSlNUaW1lU2Vjb25kcyIsImN1cnJlbnRQbGF5ZXJUaW1lIiwiY29uc29sZSIsImxvZyIsIiQiLCJnZXRFbGVtZW50QnlJZCIsIm9ucGxheSIsImFzc2V0RHVyYXRpb24iLCJkdXJhdGlvbiIsImJlYWNvblR5cGUiLCJpc0ZpcmVkIiwic2V0QmVhY29uIiwicHJvY2Vzc0JlYWNvbnMiLCJzZXRJbnRlcnZhbCIsInByZXZQbGF5ZXJUaW1lIiwiY3VycmVudFRpbWUiLCJjdXJyZW50UGxheWVyU3RhdGUiLCJlcnJvciIsIm9ucGF1c2UiLCJjbGVhckludGVydmFsIiwib25zdGFsbGVkIiwib25zZWVraW5nIiwib25zZWVrZWQiLCJldmVudCIs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LCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSA2KTtcbiIsImltcG9ydCAkJG9ic2VydmFibGUgZnJvbSAnc3ltYm9sLW9ic2VydmFibGUnO1xuXG4vKipcbiAqIFRoZXNlIGFyZSBwcml2YXRlIGFjdGlvbiB0eXBlcyByZXNlcnZlZCBieSBSZWR1eC5cbiAqIEZvciBhbnkgdW5rbm93biBhY3Rpb25zLCB5b3UgbXVzdCByZXR1cm4gdGhlIGN1cnJlbnQgc3RhdGUuXG4gKiBJZiB0aGUgY3VycmVudCBzdGF0ZSBpcyB1bmRlZmluZWQsIHlvdSBtdXN0IHJldHVybiB0aGUgaW5pdGlhbCBzdGF0ZS5cbiAqIERvIG5vdCByZWZlcmVuY2UgdGhlc2UgYWN0aW9uIHR5cGVzIGRpcmVjdGx5IGluIHlvdXIgY29kZS5cbiAqL1xudmFyIHJhbmRvbVN0cmluZyA9IGZ1bmN0aW9uIHJhbmRvbVN0cmluZygpIHtcbiAgcmV0dXJuIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZyg3KS5zcGxpdCgnJykuam9pbignLicpO1xufTtcblxudmFyIEFjdGlvblR5cGVzID0ge1xuICBJTklUOiBcIkBAcmVkdXgvSU5JVFwiICsgcmFuZG9tU3RyaW5nKCksXG4gIFJFUExBQ0U6IFwiQEByZWR1eC9SRVBMQUNFXCIgKyByYW5kb21TdHJpbmcoKSxcbiAgUFJPQkVfVU5LTk9XTl9BQ1RJT046IGZ1bmN0aW9uIFBST0JFX1VOS05PV05fQUNUSU9OKCkge1xuICAgIHJldHVybiBcIkBAcmVkdXgvUFJPQkVfVU5LTk9XTl9BQ1RJT05cIiArIHJhbmRvbVN0cmluZygpO1xuICB9XG59O1xuXG4vKipcbiAqIEBwYXJhbSB7YW55fSBvYmogVGhlIG9iamVjdCB0byBpbnNwZWN0LlxuICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIGFyZ3VtZW50IGFwcGVhcnMgdG8gYmUgYSBwbGFpbiBvYmplY3QuXG4gKi9cbmZ1bmN0aW9uIGlzUGxhaW5PYmplY3Qob2JqKSB7XG4gIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCBvYmogPT09IG51bGwpIHJldHVybiBmYWxzZTtcbiAgdmFyIHByb3RvID0gb2JqO1xuXG4gIHdoaWxlIChPYmplY3QuZ2V0UHJvdG90eXBlT2YocHJvdG8pICE9PSBudWxsKSB7XG4gICAgcHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YocHJvdG8pO1xuICB9XG5cbiAgcmV0dXJuIE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmopID09PSBwcm90bztcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgUmVkdXggc3RvcmUgdGhhdCBob2xkcyB0aGUgc3RhdGUgdHJlZS5cbiAqIFRoZSBvbmx5IHdheSB0byBjaGFuZ2UgdGhlIGRhdGEgaW4gdGhlIHN0b3JlIGlzIHRvIGNhbGwgYGRpc3BhdGNoKClgIG9uIGl0LlxuICpcbiAqIFRoZXJlIHNob3VsZCBvbmx5IGJlIGEgc2luZ2xlIHN0b3JlIGluIHlvdXIgYXBwLiBUbyBzcGVjaWZ5IGhvdyBkaWZmZXJlbnRcbiAqIHBhcnRzIG9mIHRoZSBzdGF0ZSB0cmVlIHJlc3BvbmQgdG8gYWN0aW9ucywgeW91IG1heSBjb21iaW5lIHNldmVyYWwgcmVkdWNlcnNcbiAqIGludG8gYSBzaW5nbGUgcmVkdWNlciBmdW5jdGlvbiBieSB1c2luZyBgY29tYmluZVJlZHVjZXJzYC5cbiAqXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSByZWR1Y2VyIEEgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHRoZSBuZXh0IHN0YXRlIHRyZWUsIGdpdmVuXG4gKiB0aGUgY3VycmVudCBzdGF0ZSB0cmVlIGFuZCB0aGUgYWN0aW9uIHRvIGhhbmRsZS5cbiAqXG4gKiBAcGFyYW0ge2FueX0gW3ByZWxvYWRlZFN0YXRlXSBUaGUgaW5pdGlhbCBzdGF0ZS4gWW91IG1heSBvcHRpb25hbGx5IHNwZWNpZnkgaXRcbiAqIHRvIGh5ZHJhdGUgdGhlIHN0YXRlIGZyb20gdGhlIHNlcnZlciBpbiB1bml2ZXJzYWwgYXBwcywgb3IgdG8gcmVzdG9yZSBhXG4gKiBwcmV2aW91c2x5IHNlcmlhbGl6ZWQgdXNlciBzZXNzaW9uLlxuICogSWYgeW91IHVzZSBgY29tYmluZVJlZHVjZXJzYCB0byBwcm9kdWNlIHRoZSByb290IHJlZHVjZXIgZnVuY3Rpb24sIHRoaXMgbXVzdCBiZVxuICogYW4gb2JqZWN0IHdpdGggdGhlIHNhbWUgc2hhcGUgYXMgYGNvbWJpbmVSZWR1Y2Vyc2Aga2V5cy5cbiAqXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBbZW5oYW5jZXJdIFRoZSBzdG9yZSBlbmhhbmNlci4gWW91IG1heSBvcHRpb25hbGx5IHNwZWNpZnkgaXRcbiAqIHRvIGVuaGFuY2UgdGhlIHN0b3JlIHdpdGggdGhpcmQtcGFydHkgY2FwYWJpbGl0aWVzIHN1Y2ggYXMgbWlkZGxld2FyZSxcbiAqIHRpbWUgdHJhdmVsLCBwZXJzaXN0ZW5jZSwgZXRjLiBUaGUgb25seSBzdG9yZSBlbmhhbmNlciB0aGF0IHNoaXBzIHdpdGggUmVkdXhcbiAqIGlzIGBhcHBseU1pZGRsZXdhcmUoKWAuXG4gKlxuICogQHJldHVybnMge1N0b3JlfSBBIFJlZHV4IHN0b3JlIHRoYXQgbGV0cyB5b3UgcmVhZCB0aGUgc3RhdGUsIGRpc3BhdGNoIGFjdGlvbnNcbiAqIGFuZCBzdWJzY3JpYmUgdG8gY2hhbmdlcy5cbiAqL1xuXG5mdW5jdGlvbiBjcmVhdGVTdG9yZShyZWR1Y2VyLCBwcmVsb2FkZWRTdGF0ZSwgZW5oYW5jZXIpIHtcbiAgdmFyIF9yZWYyO1xuXG4gIGlmICh0eXBlb2YgcHJlbG9hZGVkU3RhdGUgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIGVuaGFuY2VyID09PSAnZnVuY3Rpb24nIHx8IHR5cGVvZiBlbmhhbmNlciA9PT0gJ2Z1bmN0aW9uJyAmJiB0eXBlb2YgYXJndW1lbnRzWzNdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdJdCBsb29rcyBsaWtlIHlvdSBhcmUgcGFzc2luZyBzZXZlcmFsIHN0b3JlIGVuaGFuY2VycyB0byAnICsgJ2NyZWF0ZVN0b3JlKCkuIFRoaXMgaXMgbm90IHN1cHBvcnRlZC4gSW5zdGVhZCwgY29tcG9zZSB0aGVtICcgKyAndG9nZXRoZXIgdG8gYSBzaW5nbGUgZnVuY3Rpb24uJyk7XG4gIH1cblxuICBpZiAodHlwZW9mIHByZWxvYWRlZFN0YXRlID09PSAnZnVuY3Rpb24nICYmIHR5cGVvZiBlbmhhbmNlciA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBlbmhhbmNlciA9IHByZWxvYWRlZFN0YXRlO1xuICAgIHByZWxvYWRlZFN0YXRlID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgaWYgKHR5cGVvZiBlbmhhbmNlciAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBpZiAodHlwZW9mIGVuaGFuY2VyICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIHRoZSBlbmhhbmNlciB0byBiZSBhIGZ1bmN0aW9uLicpO1xuICAgIH1cblxuICAgIHJldHVybiBlbmhhbmNlcihjcmVhdGVTdG9yZSkocmVkdWNlciwgcHJlbG9hZGVkU3RhdGUpO1xuICB9XG5cbiAgaWYgKHR5cGVvZiByZWR1Y2VyICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdFeHBlY3RlZCB0aGUgcmVkdWNlciB0byBiZSBhIGZ1bmN0aW9uLicpO1xuICB9XG5cbiAgdmFyIGN1cnJlbnRSZWR1Y2VyID0gcmVkdWNlcjtcbiAgdmFyIGN1cnJlbnRTdGF0ZSA9IHByZWxvYWRlZFN0YXRlO1xuICB2YXIgY3VycmVudExpc3RlbmVycyA9IFtdO1xuICB2YXIgbmV4dExpc3RlbmVycyA9IGN1cnJlbnRMaXN0ZW5lcnM7XG4gIHZhciBpc0Rpc3BhdGNoaW5nID0gZmFsc2U7XG4gIC8qKlxuICAgKiBUaGlzIG1ha2VzIGEgc2hhbGxvdyBjb3B5IG9mIGN1cnJlbnRMaXN0ZW5lcnMgc28gd2UgY2FuIHVzZVxuICAgKiBuZXh0TGlzdGVuZXJzIGFzIGEgdGVtcG9yYXJ5IGxpc3Qgd2hpbGUgZGlzcGF0Y2hpbmcuXG4gICAqXG4gICAqIFRoaXMgcHJldmVudHMgYW55IGJ1Z3MgYXJvdW5kIGNvbnN1bWVycyBjYWxsaW5nXG4gICAqIHN1YnNjcmliZS91bnN1YnNjcmliZSBpbiB0aGUgbWlkZGxlIG9mIGEgZGlzcGF0Y2guXG4gICAqL1xuXG4gIGZ1bmN0aW9uIGVuc3VyZUNhbk11dGF0ZU5leHRMaXN0ZW5lcnMoKSB7XG4gICAgaWYgKG5leHRMaXN0ZW5lcnMgPT09IGN1cnJlbnRMaXN0ZW5lcnMpIHtcbiAgICAgIG5leHRMaXN0ZW5lcnMgPSBjdXJyZW50TGlzdGVuZXJzLnNsaWNlKCk7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBSZWFkcyB0aGUgc3RhdGUgdHJlZSBtYW5hZ2VkIGJ5IHRoZSBzdG9yZS5cbiAgICpcbiAgICogQHJldHVybnMge2FueX0gVGhlIGN1cnJlbnQgc3RhdGUgdHJlZSBvZiB5b3VyIGFwcGxpY2F0aW9uLlxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIGdldFN0YXRlKCkge1xuICAgIGlmIChpc0Rpc3BhdGNoaW5nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1lvdSBtYXkgbm90IGNhbGwgc3RvcmUuZ2V0U3RhdGUoKSB3aGlsZSB0aGUgcmVkdWNlciBpcyBleGVjdXRpbmcuICcgKyAnVGhlIHJlZHVjZXIgaGFzIGFscmVhZHkgcmVjZWl2ZWQgdGhlIHN0YXRlIGFzIGFuIGFyZ3VtZW50LiAnICsgJ1Bhc3MgaXQgZG93biBmcm9tIHRoZSB0b3AgcmVkdWNlciBpbnN0ZWFkIG9mIHJlYWRpbmcgaXQgZnJvbSB0aGUgc3RvcmUuJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGN1cnJlbnRTdGF0ZTtcbiAgfVxuICAvKipcbiAgICogQWRkcyBhIGNoYW5nZSBsaXN0ZW5lci4gSXQgd2lsbCBiZSBjYWxsZWQgYW55IHRpbWUgYW4gYWN0aW9uIGlzIGRpc3BhdGNoZWQsXG4gICAqIGFuZCBzb21lIHBhcnQgb2YgdGhlIHN0YXRlIHRyZWUgbWF5IHBvdGVudGlhbGx5IGhhdmUgY2hhbmdlZC4gWW91IG1heSB0aGVuXG4gICAqIGNhbGwgYGdldFN0YXRlKClgIHRvIHJlYWQgdGhlIGN1cnJlbnQgc3RhdGUgdHJlZSBpbnNpZGUgdGhlIGNhbGxiYWNrLlxuICAgKlxuICAgKiBZb3UgbWF5IGNhbGwgYGRpc3BhdGNoKClgIGZyb20gYSBjaGFuZ2UgbGlzdGVuZXIsIHdpdGggdGhlIGZvbGxvd2luZ1xuICAgKiBjYXZlYXRzOlxuICAgKlxuICAgKiAxLiBUaGUgc3Vic2NyaXB0aW9ucyBhcmUgc25hcHNob3R0ZWQganVzdCBiZWZvcmUgZXZlcnkgYGRpc3BhdGNoKClgIGNhbGwuXG4gICAqIElmIHlvdSBzdWJzY3JpYmUgb3IgdW5zdWJzY3JpYmUgd2hpbGUgdGhlIGxpc3RlbmVycyBhcmUgYmVpbmcgaW52b2tlZCwgdGhpc1xuICAgKiB3aWxsIG5vdCBoYXZlIGFueSBlZmZlY3Qgb24gdGhlIGBkaXNwYXRjaCgpYCB0aGF0IGlzIGN1cnJlbnRseSBpbiBwcm9ncmVzcy5cbiAgICogSG93ZXZlciwgdGhlIG5leHQgYGRpc3BhdGNoKClgIGNhbGwsIHdoZXRoZXIgbmVzdGVkIG9yIG5vdCwgd2lsbCB1c2UgYSBtb3JlXG4gICAqIHJlY2VudCBzbmFwc2hvdCBvZiB0aGUgc3Vic2NyaXB0aW9uIGxpc3QuXG4gICAqXG4gICAqIDIuIFRoZSBsaXN0ZW5lciBzaG91bGQgbm90IGV4cGVjdCB0byBzZWUgYWxsIHN0YXRlIGNoYW5nZXMsIGFzIHRoZSBzdGF0ZVxuICAgKiBtaWdodCBoYXZlIGJlZW4gdXBkYXRlZCBtdWx0aXBsZSB0aW1lcyBkdXJpbmcgYSBuZXN0ZWQgYGRpc3BhdGNoKClgIGJlZm9yZVxuICAgKiB0aGUgbGlzdGVuZXIgaXMgY2FsbGVkLiBJdCBpcywgaG93ZXZlciwgZ3VhcmFudGVlZCB0aGF0IGFsbCBzdWJzY3JpYmVyc1xuICAgKiByZWdpc3RlcmVkIGJlZm9yZSB0aGUgYGRpc3BhdGNoKClgIHN0YXJ0ZWQgd2lsbCBiZSBjYWxsZWQgd2l0aCB0aGUgbGF0ZXN0XG4gICAqIHN0YXRlIGJ5IHRoZSB0aW1lIGl0IGV4aXRzLlxuICAgKlxuICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBsaXN0ZW5lciBBIGNhbGxiYWNrIHRvIGJlIGludm9rZWQgb24gZXZlcnkgZGlzcGF0Y2guXG4gICAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBmdW5jdGlvbiB0byByZW1vdmUgdGhpcyBjaGFuZ2UgbGlzdGVuZXIuXG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gc3Vic2NyaWJlKGxpc3RlbmVyKSB7XG4gICAgaWYgKHR5cGVvZiBsaXN0ZW5lciAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdFeHBlY3RlZCB0aGUgbGlzdGVuZXIgdG8gYmUgYSBmdW5jdGlvbi4nKTtcbiAgICB9XG5cbiAgICBpZiAoaXNEaXNwYXRjaGluZykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdZb3UgbWF5IG5vdCBjYWxsIHN0b3JlLnN1YnNjcmliZSgpIHdoaWxlIHRoZSByZWR1Y2VyIGlzIGV4ZWN1dGluZy4gJyArICdJZiB5b3Ugd291bGQgbGlrZSB0byBiZSBub3RpZmllZCBhZnRlciB0aGUgc3RvcmUgaGFzIGJlZW4gdXBkYXRlZCwgc3Vic2NyaWJlIGZyb20gYSAnICsgJ2NvbXBvbmVudCBhbmQgaW52b2tlIHN0b3JlLmdldFN0YXRlKCkgaW4gdGhlIGNhbGxiYWNrIHRvIGFjY2VzcyB0aGUgbGF0ZXN0IHN0YXRlLiAnICsgJ1NlZSBodHRwczovL3JlZHV4LmpzLm9yZy9hcGktcmVmZXJlbmNlL3N0b3JlI3N1YnNjcmliZWxpc3RlbmVyIGZvciBtb3JlIGRldGFpbHMuJyk7XG4gICAgfVxuXG4gICAgdmFyIGlzU3Vic2NyaWJlZCA9IHRydWU7XG4gICAgZW5zdXJlQ2FuTXV0YXRlTmV4dExpc3RlbmVycygpO1xuICAgIG5leHRMaXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIHVuc3Vic2NyaWJlKCkge1xuICAgICAgaWYgKCFpc1N1YnNjcmliZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoaXNEaXNwYXRjaGluZykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1lvdSBtYXkgbm90IHVuc3Vic2NyaWJlIGZyb20gYSBzdG9yZSBsaXN0ZW5lciB3aGlsZSB0aGUgcmVkdWNlciBpcyBleGVjdXRpbmcuICcgKyAnU2VlIGh0dHBzOi8vcmVkdXguanMub3JnL2FwaS1yZWZlcmVuY2Uvc3RvcmUjc3Vic2NyaWJlbGlzdGVuZXIgZm9yIG1vcmUgZGV0YWlscy4nKTtcbiAgICAgIH1cblxuICAgICAgaXNTdWJzY3JpYmVkID0gZmFsc2U7XG4gICAgICBlbnN1cmVDYW5NdXRhdGVOZXh0TGlzdGVuZXJzKCk7XG4gICAgICB2YXIgaW5kZXggPSBuZXh0TGlzdGVuZXJzLmluZGV4T2YobGlzdGVuZXIpO1xuICAgICAgbmV4dExpc3RlbmVycy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgY3VycmVudExpc3RlbmVycyA9IG51bGw7XG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogRGlzcGF0Y2hlcyBhbiBhY3Rpb24uIEl0IGlzIHRoZSBvbmx5IHdheSB0byB0cmlnZ2VyIGEgc3RhdGUgY2hhbmdlLlxuICAgKlxuICAgKiBUaGUgYHJlZHVjZXJgIGZ1bmN0aW9uLCB1c2VkIHRvIGNyZWF0ZSB0aGUgc3RvcmUsIHdpbGwgYmUgY2FsbGVkIHdpdGggdGhlXG4gICAqIGN1cnJlbnQgc3RhdGUgdHJlZSBhbmQgdGhlIGdpdmVuIGBhY3Rpb25gLiBJdHMgcmV0dXJuIHZhbHVlIHdpbGxcbiAgICogYmUgY29uc2lkZXJlZCB0aGUgKipuZXh0Kiogc3RhdGUgb2YgdGhlIHRyZWUsIGFuZCB0aGUgY2hhbmdlIGxpc3RlbmVyc1xuICAgKiB3aWxsIGJlIG5vdGlmaWVkLlxuICAgKlxuICAgKiBUaGUgYmFzZSBpbXBsZW1lbnRhdGlvbiBvbmx5IHN1cHBvcnRzIHBsYWluIG9iamVjdCBhY3Rpb25zLiBJZiB5b3Ugd2FudCB0b1xuICAgKiBkaXNwYXRjaCBhIFByb21pc2UsIGFuIE9ic2VydmFibGUsIGEgdGh1bmssIG9yIHNvbWV0aGluZyBlbHNlLCB5b3UgbmVlZCB0b1xuICAgKiB3cmFwIHlvdXIgc3RvcmUgY3JlYXRpbmcgZnVuY3Rpb24gaW50byB0aGUgY29ycmVzcG9uZGluZyBtaWRkbGV3YXJlLiBGb3JcbiAgICogZXhhbXBsZSwgc2VlIHRoZSBkb2N1bWVudGF0aW9uIGZvciB0aGUgYHJlZHV4LXRodW5rYCBwYWNrYWdlLiBFdmVuIHRoZVxuICAgKiBtaWRkbGV3YXJlIHdpbGwgZXZlbnR1YWxseSBkaXNwYXRjaCBwbGFpbiBvYmplY3QgYWN0aW9ucyB1c2luZyB0aGlzIG1ldGhvZC5cbiAgICpcbiAgICogQHBhcmFtIHtPYmplY3R9IGFjdGlvbiBBIHBsYWluIG9iamVjdCByZXByZXNlbnRpbmcg4oCcd2hhdCBjaGFuZ2Vk4oCdLiBJdCBpc1xuICAgKiBhIGdvb2QgaWRlYSB0byBrZWVwIGFjdGlvbnMgc2VyaWFsaXphYmxlIHNvIHlvdSBjYW4gcmVjb3JkIGFuZCByZXBsYXkgdXNlclxuICAgKiBzZXNzaW9ucywgb3IgdXNlIHRoZSB0aW1lIHRyYXZlbGxpbmcgYHJlZHV4LWRldnRvb2xzYC4gQW4gYWN0aW9uIG11c3QgaGF2ZVxuICAgKiBhIGB0eXBlYCBwcm9wZXJ0eSB3aGljaCBtYXkgbm90IGJlIGB1bmRlZmluZWRgLiBJdCBpcyBhIGdvb2QgaWRlYSB0byB1c2VcbiAgICogc3RyaW5nIGNvbnN0YW50cyBmb3IgYWN0aW9uIHR5cGVzLlxuICAgKlxuICAgKiBAcmV0dXJucyB7T2JqZWN0fSBGb3IgY29udmVuaWVuY2UsIHRoZSBzYW1lIGFjdGlvbiBvYmplY3QgeW91IGRpc3BhdGNoZWQuXG4gICAqXG4gICAqIE5vdGUgdGhhdCwgaWYgeW91IHVzZSBhIGN1c3RvbSBtaWRkbGV3YXJlLCBpdCBtYXkgd3JhcCBgZGlzcGF0Y2goKWAgdG9cbiAgICogcmV0dXJuIHNvbWV0aGluZyBlbHNlIChmb3IgZXhhbXBsZSwgYSBQcm9taXNlIHlvdSBjYW4gYXdhaXQpLlxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIGRpc3BhdGNoKGFjdGlvbikge1xuICAgIGlmICghaXNQbGFpbk9iamVjdChhY3Rpb24pKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FjdGlvbnMgbXVzdCBiZSBwbGFpbiBvYmplY3RzLiAnICsgJ1VzZSBjdXN0b20gbWlkZGxld2FyZSBmb3IgYXN5bmMgYWN0aW9ucy4nKTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGFjdGlvbi50eXBlID09PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdBY3Rpb25zIG1heSBub3QgaGF2ZSBhbiB1bmRlZmluZWQgXCJ0eXBlXCIgcHJvcGVydHkuICcgKyAnSGF2ZSB5b3UgbWlzc3BlbGxlZCBhIGNvbnN0YW50PycpO1xuICAgIH1cblxuICAgIGlmIChpc0Rpc3BhdGNoaW5nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1JlZHVjZXJzIG1heSBub3QgZGlzcGF0Y2ggYWN0aW9ucy4nKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgaXNEaXNwYXRjaGluZyA9IHRydWU7XG4gICAgICBjdXJyZW50U3RhdGUgPSBjdXJyZW50UmVkdWNlcihjdXJyZW50U3RhdGUsIGFjdGlvbik7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGlzRGlzcGF0Y2hpbmcgPSBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgbGlzdGVuZXJzID0gY3VycmVudExpc3RlbmVycyA9IG5leHRMaXN0ZW5lcnM7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGxpc3RlbmVyID0gbGlzdGVuZXJzW2ldO1xuICAgICAgbGlzdGVuZXIoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYWN0aW9uO1xuICB9XG4gIC8qKlxuICAgKiBSZXBsYWNlcyB0aGUgcmVkdWNlciBjdXJyZW50bHkgdXNlZCBieSB0aGUgc3RvcmUgdG8gY2FsY3VsYXRlIHRoZSBzdGF0ZS5cbiAgICpcbiAgICogWW91IG1pZ2h0IG5lZWQgdGhpcyBpZiB5b3VyIGFwcCBpbXBsZW1lbnRzIGNvZGUgc3BsaXR0aW5nIGFuZCB5b3Ugd2FudCB0b1xuICAgKiBsb2FkIHNvbWUgb2YgdGhlIHJlZHVjZXJzIGR5bmFtaWNhbGx5LiBZb3UgbWlnaHQgYWxzbyBuZWVkIHRoaXMgaWYgeW91XG4gICAqIGltcGxlbWVudCBhIGhvdCByZWxvYWRpbmcgbWVjaGFuaXNtIGZvciBSZWR1eC5cbiAgICpcbiAgICogQHBhcmFtIHtGdW5jdGlvbn0gbmV4dFJlZHVjZXIgVGhlIHJlZHVjZXIgZm9yIHRoZSBzdG9yZSB0byB1c2UgaW5zdGVhZC5cbiAgICogQHJldHVybnMge3ZvaWR9XG4gICAqL1xuXG5cbiAgZnVuY3Rpb24gcmVwbGFjZVJlZHVjZXIobmV4dFJlZHVjZXIpIHtcbiAgICBpZiAodHlwZW9mIG5leHRSZWR1Y2VyICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkIHRoZSBuZXh0UmVkdWNlciB0byBiZSBhIGZ1bmN0aW9uLicpO1xuICAgIH1cblxuICAgIGN1cnJlbnRSZWR1Y2VyID0gbmV4dFJlZHVjZXI7IC8vIFRoaXMgYWN0aW9uIGhhcyBhIHNpbWlsaWFyIGVmZmVjdCB0byBBY3Rpb25UeXBlcy5JTklULlxuICAgIC8vIEFueSByZWR1Y2VycyB0aGF0IGV4aXN0ZWQgaW4gYm90aCB0aGUgbmV3IGFuZCBvbGQgcm9vdFJlZHVjZXJcbiAgICAvLyB3aWxsIHJlY2VpdmUgdGhlIHByZXZpb3VzIHN0YXRlLiBUaGlzIGVmZmVjdGl2ZWx5IHBvcHVsYXRlc1xuICAgIC8vIHRoZSBuZXcgc3RhdGUgdHJlZSB3aXRoIGFueSByZWxldmFudCBkYXRhIGZyb20gdGhlIG9sZCBvbmUuXG5cbiAgICBkaXNwYXRjaCh7XG4gICAgICB0eXBlOiBBY3Rpb25UeXBlcy5SRVBMQUNFXG4gICAgfSk7XG4gIH1cbiAgLyoqXG4gICAqIEludGVyb3BlcmFiaWxpdHkgcG9pbnQgZm9yIG9ic2VydmFibGUvcmVhY3RpdmUgbGlicmFyaWVzLlxuICAgKiBAcmV0dXJucyB7b2JzZXJ2YWJsZX0gQSBtaW5pbWFsIG9ic2VydmFibGUgb2Ygc3RhdGUgY2hhbmdlcy5cbiAgICogRm9yIG1vcmUgaW5mb3JtYXRpb24sIHNlZSB0aGUgb2JzZXJ2YWJsZSBwcm9wb3NhbDpcbiAgICogaHR0cHM6Ly9naXRodWIuY29tL3RjMzkvcHJvcG9zYWwtb2JzZXJ2YWJsZVxuICAgKi9cblxuXG4gIGZ1bmN0aW9uIG9ic2VydmFibGUoKSB7XG4gICAgdmFyIF9yZWY7XG5cbiAgICB2YXIgb3V0ZXJTdWJzY3JpYmUgPSBzdWJzY3JpYmU7XG4gICAgcmV0dXJuIF9yZWYgPSB7XG4gICAgICAvKipcbiAgICAgICAqIFRoZSBtaW5pbWFsIG9ic2VydmFibGUgc3Vic2NyaXB0aW9uIG1ldGhvZC5cbiAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvYnNlcnZlciBBbnkgb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgYXMgYW4gb2JzZXJ2ZXIuXG4gICAgICAgKiBUaGUgb2JzZXJ2ZXIgb2JqZWN0IHNob3VsZCBoYXZlIGEgYG5leHRgIG1ldGhvZC5cbiAgICAgICAqIEByZXR1cm5zIHtzdWJzY3JpcHRpb259IEFuIG9iamVjdCB3aXRoIGFuIGB1bnN1YnNjcmliZWAgbWV0aG9kIHRoYXQgY2FuXG4gICAgICAgKiBiZSB1c2VkIHRvIHVuc3Vic2NyaWJlIHRoZSBvYnNlcnZhYmxlIGZyb20gdGhlIHN0b3JlLCBhbmQgcHJldmVudCBmdXJ0aGVyXG4gICAgICAgKiBlbWlzc2lvbiBvZiB2YWx1ZXMgZnJvbSB0aGUgb2JzZXJ2YWJsZS5cbiAgICAgICAqL1xuICAgICAgc3Vic2NyaWJlOiBmdW5jdGlvbiBzdWJzY3JpYmUob2JzZXJ2ZXIpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBvYnNlcnZlciAhPT0gJ29iamVjdCcgfHwgb2JzZXJ2ZXIgPT09IG51bGwpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFeHBlY3RlZCB0aGUgb2JzZXJ2ZXIgdG8gYmUgYW4gb2JqZWN0LicpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gb2JzZXJ2ZVN0YXRlKCkge1xuICAgICAgICAgIGlmIChvYnNlcnZlci5uZXh0KSB7XG4gICAgICAgICAgICBvYnNlcnZlci5uZXh0KGdldFN0YXRlKCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIG9ic2VydmVTdGF0ZSgpO1xuICAgICAgICB2YXIgdW5zdWJzY3JpYmUgPSBvdXRlclN1YnNjcmliZShvYnNlcnZlU3RhdGUpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHVuc3Vic2NyaWJlOiB1bnN1YnNjcmliZVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0sIF9yZWZbJCRvYnNlcnZhYmxlXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sIF9yZWY7XG4gIH0gLy8gV2hlbiBhIHN0b3JlIGlzIGNyZWF0ZWQsIGFuIFwiSU5JVFwiIGFjdGlvbiBpcyBkaXNwYXRjaGVkIHNvIHRoYXQgZXZlcnlcbiAgLy8gcmVkdWNlciByZXR1cm5zIHRoZWlyIGluaXRpYWwgc3RhdGUuIFRoaXMgZWZmZWN0aXZlbHkgcG9wdWxhdGVzXG4gIC8vIHRoZSBpbml0aWFsIHN0YXRlIHRyZWUuXG5cblxuICBkaXNwYXRjaCh7XG4gICAgdHlwZTogQWN0aW9uVHlwZXMuSU5JVFxuICB9KTtcbiAgcmV0dXJuIF9yZWYyID0ge1xuICAgIGRpc3BhdGNoOiBkaXNwYXRjaCxcbiAgICBzdWJzY3JpYmU6IHN1YnNjcmliZSxcbiAgICBnZXRTdGF0ZTogZ2V0U3RhdGUsXG4gICAgcmVwbGFjZVJlZHVjZXI6IHJlcGxhY2VSZWR1Y2VyXG4gIH0sIF9yZWYyWyQkb2JzZXJ2YWJsZV0gPSBvYnNlcnZhYmxlLCBfcmVmMjtcbn1cblxuLyoqXG4gKiBQcmludHMgYSB3YXJuaW5nIGluIHRoZSBjb25zb2xlIGlmIGl0IGV4aXN0cy5cbiAqXG4gKiBAcGFyYW0ge1N0cmluZ30gbWVzc2FnZSBUaGUgd2FybmluZyBtZXNzYWdlLlxuICogQHJldHVybnMge3ZvaWR9XG4gKi9cbmZ1bmN0aW9uIHdhcm5pbmcobWVzc2FnZSkge1xuICAvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovXG4gIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGNvbnNvbGUuZXJyb3IgPT09ICdmdW5jdGlvbicpIHtcbiAgICBjb25zb2xlLmVycm9yKG1lc3NhZ2UpO1xuICB9XG4gIC8qIGVzbGludC1lbmFibGUgbm8tY29uc29sZSAqL1xuXG5cbiAgdHJ5IHtcbiAgICAvLyBUaGlzIGVycm9yIHdhcyB0aHJvd24gYXMgYSBjb252ZW5pZW5jZSBzbyB0aGF0IGlmIHlvdSBlbmFibGVcbiAgICAvLyBcImJyZWFrIG9uIGFsbCBleGNlcHRpb25zXCIgaW4geW91ciBjb25zb2xlLFxuICAgIC8vIGl0IHdvdWxkIHBhdXNlIHRoZSBleGVjdXRpb24gYXQgdGhpcyBsaW5lLlxuICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTtcbiAgfSBjYXRjaCAoZSkge30gLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1lbXB0eVxuXG59XG5cbmZ1bmN0aW9uIGdldFVuZGVmaW5lZFN0YXRlRXJyb3JNZXNzYWdlKGtleSwgYWN0aW9uKSB7XG4gIHZhciBhY3Rpb25UeXBlID0gYWN0aW9uICYmIGFjdGlvbi50eXBlO1xuICB2YXIgYWN0aW9uRGVzY3JpcHRpb24gPSBhY3Rpb25UeXBlICYmIFwiYWN0aW9uIFxcXCJcIiArIFN0cmluZyhhY3Rpb25UeXBlKSArIFwiXFxcIlwiIHx8ICdhbiBhY3Rpb24nO1xuICByZXR1cm4gXCJHaXZlbiBcIiArIGFjdGlvbkRlc2NyaXB0aW9uICsgXCIsIHJlZHVjZXIgXFxcIlwiICsga2V5ICsgXCJcXFwiIHJldHVybmVkIHVuZGVmaW5lZC4gXCIgKyBcIlRvIGlnbm9yZSBhbiBhY3Rpb24sIHlvdSBtdXN0IGV4cGxpY2l0bHkgcmV0dXJuIHRoZSBwcmV2aW91cyBzdGF0ZS4gXCIgKyBcIklmIHlvdSB3YW50IHRoaXMgcmVkdWNlciB0byBob2xkIG5vIHZhbHVlLCB5b3UgY2FuIHJldHVybiBudWxsIGluc3RlYWQgb2YgdW5kZWZpbmVkLlwiO1xufVxuXG5mdW5jdGlvbiBnZXRVbmV4cGVjdGVkU3RhdGVTaGFwZVdhcm5pbmdNZXNzYWdlKGlucHV0U3RhdGUsIHJlZHVjZXJzLCBhY3Rpb24sIHVuZXhwZWN0ZWRLZXlDYWNoZSkge1xuICB2YXIgcmVkdWNlcktleXMgPSBPYmplY3Qua2V5cyhyZWR1Y2Vycyk7XG4gIHZhciBhcmd1bWVudE5hbWUgPSBhY3Rpb24gJiYgYWN0aW9uLnR5cGUgPT09IEFjdGlvblR5cGVzLklOSVQgPyAncHJlbG9hZGVkU3RhdGUgYXJndW1lbnQgcGFzc2VkIHRvIGNyZWF0ZVN0b3JlJyA6ICdwcmV2aW91cyBzdGF0ZSByZWNlaXZlZCBieSB0aGUgcmVkdWNlcic7XG5cbiAgaWYgKHJlZHVjZXJLZXlzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiAnU3RvcmUgZG9lcyBub3QgaGF2ZSBhIHZhbGlkIHJlZHVjZXIuIE1ha2Ugc3VyZSB0aGUgYXJndW1lbnQgcGFzc2VkICcgKyAndG8gY29tYmluZVJlZHVjZXJzIGlzIGFuIG9iamVjdCB3aG9zZSB2YWx1ZXMgYXJlIHJlZHVjZXJzLic7XG4gIH1cblxuICBpZiAoIWlzUGxhaW5PYmplY3QoaW5wdXRTdGF0ZSkpIHtcbiAgICByZXR1cm4gXCJUaGUgXCIgKyBhcmd1bWVudE5hbWUgKyBcIiBoYXMgdW5leHBlY3RlZCB0eXBlIG9mIFxcXCJcIiArIHt9LnRvU3RyaW5nLmNhbGwoaW5wdXRTdGF0ZSkubWF0Y2goL1xccyhbYS16fEEtWl0rKS8pWzFdICsgXCJcXFwiLiBFeHBlY3RlZCBhcmd1bWVudCB0byBiZSBhbiBvYmplY3Qgd2l0aCB0aGUgZm9sbG93aW5nIFwiICsgKFwia2V5czogXFxcIlwiICsgcmVkdWNlcktleXMuam9pbignXCIsIFwiJykgKyBcIlxcXCJcIik7XG4gIH1cblxuICB2YXIgdW5leHBlY3RlZEtleXMgPSBPYmplY3Qua2V5cyhpbnB1dFN0YXRlKS5maWx0ZXIoZnVuY3Rpb24gKGtleSkge1xuICAgIHJldHVybiAhcmVkdWNlcnMuaGFzT3duUHJvcGVydHkoa2V5KSAmJiAhdW5leHBlY3RlZEtleUNhY2hlW2tleV07XG4gIH0pO1xuICB1bmV4cGVjdGVkS2V5cy5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICB1bmV4cGVjdGVkS2V5Q2FjaGVba2V5XSA9IHRydWU7XG4gIH0pO1xuICBpZiAoYWN0aW9uICYmIGFjdGlvbi50eXBlID09PSBBY3Rpb25UeXBlcy5SRVBMQUNFKSByZXR1cm47XG5cbiAgaWYgKHVuZXhwZWN0ZWRLZXlzLmxlbmd0aCA+IDApIHtcbiAgICByZXR1cm4gXCJVbmV4cGVjdGVkIFwiICsgKHVuZXhwZWN0ZWRLZXlzLmxlbmd0aCA+IDEgPyAna2V5cycgOiAna2V5JykgKyBcIiBcIiArIChcIlxcXCJcIiArIHVuZXhwZWN0ZWRLZXlzLmpvaW4oJ1wiLCBcIicpICsgXCJcXFwiIGZvdW5kIGluIFwiICsgYXJndW1lbnROYW1lICsgXCIuIFwiKSArIFwiRXhwZWN0ZWQgdG8gZmluZCBvbmUgb2YgdGhlIGtub3duIHJlZHVjZXIga2V5cyBpbnN0ZWFkOiBcIiArIChcIlxcXCJcIiArIHJlZHVjZXJLZXlzLmpvaW4oJ1wiLCBcIicpICsgXCJcXFwiLiBVbmV4cGVjdGVkIGtleXMgd2lsbCBiZSBpZ25vcmVkLlwiKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhc3NlcnRSZWR1Y2VyU2hhcGUocmVkdWNlcnMpIHtcbiAgT2JqZWN0LmtleXMocmVkdWNlcnMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgIHZhciByZWR1Y2VyID0gcmVkdWNlcnNba2V5XTtcbiAgICB2YXIgaW5pdGlhbFN0YXRlID0gcmVkdWNlcih1bmRlZmluZWQsIHtcbiAgICAgIHR5cGU6IEFjdGlvblR5cGVzLklOSVRcbiAgICB9KTtcblxuICAgIGlmICh0eXBlb2YgaW5pdGlhbFN0YXRlID09PSAndW5kZWZpbmVkJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUmVkdWNlciBcXFwiXCIgKyBrZXkgKyBcIlxcXCIgcmV0dXJuZWQgdW5kZWZpbmVkIGR1cmluZyBpbml0aWFsaXphdGlvbi4gXCIgKyBcIklmIHRoZSBzdGF0ZSBwYXNzZWQgdG8gdGhlIHJlZHVjZXIgaXMgdW5kZWZpbmVkLCB5b3UgbXVzdCBcIiArIFwiZXhwbGljaXRseSByZXR1cm4gdGhlIGluaXRpYWwgc3RhdGUuIFRoZSBpbml0aWFsIHN0YXRlIG1heSBcIiArIFwibm90IGJlIHVuZGVmaW5lZC4gSWYgeW91IGRvbid0IHdhbnQgdG8gc2V0IGEgdmFsdWUgZm9yIHRoaXMgcmVkdWNlciwgXCIgKyBcInlvdSBjYW4gdXNlIG51bGwgaW5zdGVhZCBvZiB1bmRlZmluZWQuXCIpO1xuICAgIH1cblxuICAgIGlmICh0eXBlb2YgcmVkdWNlcih1bmRlZmluZWQsIHtcbiAgICAgIHR5cGU6IEFjdGlvblR5cGVzLlBST0JFX1VOS05PV05fQUNUSU9OKClcbiAgICB9KSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlJlZHVjZXIgXFxcIlwiICsga2V5ICsgXCJcXFwiIHJldHVybmVkIHVuZGVmaW5lZCB3aGVuIHByb2JlZCB3aXRoIGEgcmFuZG9tIHR5cGUuIFwiICsgKFwiRG9uJ3QgdHJ5IHRvIGhhbmRsZSBcIiArIEFjdGlvblR5cGVzLklOSVQgKyBcIiBvciBvdGhlciBhY3Rpb25zIGluIFxcXCJyZWR1eC8qXFxcIiBcIikgKyBcIm5hbWVzcGFjZS4gVGhleSBhcmUgY29uc2lkZXJlZCBwcml2YXRlLiBJbnN0ZWFkLCB5b3UgbXVzdCByZXR1cm4gdGhlIFwiICsgXCJjdXJyZW50IHN0YXRlIGZvciBhbnkgdW5rbm93biBhY3Rpb25zLCB1bmxlc3MgaXQgaXMgdW5kZWZpbmVkLCBcIiArIFwiaW4gd2hpY2ggY2FzZSB5b3UgbXVzdCByZXR1cm4gdGhlIGluaXRpYWwgc3RhdGUsIHJlZ2FyZGxlc3Mgb2YgdGhlIFwiICsgXCJhY3Rpb24gdHlwZS4gVGhlIGluaXRpYWwgc3RhdGUgbWF5IG5vdCBiZSB1bmRlZmluZWQsIGJ1dCBjYW4gYmUgbnVsbC5cIik7XG4gICAgfVxuICB9KTtcbn1cbi8qKlxuICogVHVybnMgYW4gb2JqZWN0IHdob3NlIHZhbHVlcyBhcmUgZGlmZmVyZW50IHJlZHVjZXIgZnVuY3Rpb25zLCBpbnRvIGEgc2luZ2xlXG4gKiByZWR1Y2VyIGZ1bmN0aW9uLiBJdCB3aWxsIGNhbGwgZXZlcnkgY2hpbGQgcmVkdWNlciwgYW5kIGdhdGhlciB0aGVpciByZXN1bHRzXG4gKiBpbnRvIGEgc2luZ2xlIHN0YXRlIG9iamVjdCwgd2hvc2Uga2V5cyBjb3JyZXNwb25kIHRvIHRoZSBrZXlzIG9mIHRoZSBwYXNzZWRcbiAqIHJlZHVjZXIgZnVuY3Rpb25zLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSByZWR1Y2VycyBBbiBvYmplY3Qgd2hvc2UgdmFsdWVzIGNvcnJlc3BvbmQgdG8gZGlmZmVyZW50XG4gKiByZWR1Y2VyIGZ1bmN0aW9ucyB0aGF0IG5lZWQgdG8gYmUgY29tYmluZWQgaW50byBvbmUuIE9uZSBoYW5keSB3YXkgdG8gb2J0YWluXG4gKiBpdCBpcyB0byB1c2UgRVM2IGBpbXBvcnQgKiBhcyByZWR1Y2Vyc2Agc3ludGF4LiBUaGUgcmVkdWNlcnMgbWF5IG5ldmVyIHJldHVyblxuICogdW5kZWZpbmVkIGZvciBhbnkgYWN0aW9uLiBJbnN0ZWFkLCB0aGV5IHNob3VsZCByZXR1cm4gdGhlaXIgaW5pdGlhbCBzdGF0ZVxuICogaWYgdGhlIHN0YXRlIHBhc3NlZCB0byB0aGVtIHdhcyB1bmRlZmluZWQsIGFuZCB0aGUgY3VycmVudCBzdGF0ZSBmb3IgYW55XG4gKiB1bnJlY29nbml6ZWQgYWN0aW9uLlxuICpcbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSByZWR1Y2VyIGZ1bmN0aW9uIHRoYXQgaW52b2tlcyBldmVyeSByZWR1Y2VyIGluc2lkZSB0aGVcbiAqIHBhc3NlZCBvYmplY3QsIGFuZCBidWlsZHMgYSBzdGF0ZSBvYmplY3Qgd2l0aCB0aGUgc2FtZSBzaGFwZS5cbiAqL1xuXG5cbmZ1bmN0aW9uIGNvbWJpbmVSZWR1Y2VycyhyZWR1Y2Vycykge1xuICB2YXIgcmVkdWNlcktleXMgPSBPYmplY3Qua2V5cyhyZWR1Y2Vycyk7XG4gIHZhciBmaW5hbFJlZHVjZXJzID0ge307XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCByZWR1Y2VyS2V5cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBrZXkgPSByZWR1Y2VyS2V5c1tpXTtcblxuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICBpZiAodHlwZW9mIHJlZHVjZXJzW2tleV0gPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHdhcm5pbmcoXCJObyByZWR1Y2VyIHByb3ZpZGVkIGZvciBrZXkgXFxcIlwiICsga2V5ICsgXCJcXFwiXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0eXBlb2YgcmVkdWNlcnNba2V5XSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgZmluYWxSZWR1Y2Vyc1trZXldID0gcmVkdWNlcnNba2V5XTtcbiAgICB9XG4gIH1cblxuICB2YXIgZmluYWxSZWR1Y2VyS2V5cyA9IE9iamVjdC5rZXlzKGZpbmFsUmVkdWNlcnMpOyAvLyBUaGlzIGlzIHVzZWQgdG8gbWFrZSBzdXJlIHdlIGRvbid0IHdhcm4gYWJvdXQgdGhlIHNhbWVcbiAgLy8ga2V5cyBtdWx0aXBsZSB0aW1lcy5cblxuICB2YXIgdW5leHBlY3RlZEtleUNhY2hlO1xuXG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgdW5leHBlY3RlZEtleUNhY2hlID0ge307XG4gIH1cblxuICB2YXIgc2hhcGVBc3NlcnRpb25FcnJvcjtcblxuICB0cnkge1xuICAgIGFzc2VydFJlZHVjZXJTaGFwZShmaW5hbFJlZHVjZXJzKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHNoYXBlQXNzZXJ0aW9uRXJyb3IgPSBlO1xuICB9XG5cbiAgcmV0dXJuIGZ1bmN0aW9uIGNvbWJpbmF0aW9uKHN0YXRlLCBhY3Rpb24pIHtcbiAgICBpZiAoc3RhdGUgPT09IHZvaWQgMCkge1xuICAgICAgc3RhdGUgPSB7fTtcbiAgICB9XG5cbiAgICBpZiAoc2hhcGVBc3NlcnRpb25FcnJvcikge1xuICAgICAgdGhyb3cgc2hhcGVBc3NlcnRpb25FcnJvcjtcbiAgICB9XG5cbiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xuICAgICAgdmFyIHdhcm5pbmdNZXNzYWdlID0gZ2V0VW5leHBlY3RlZFN0YXRlU2hhcGVXYXJuaW5nTWVzc2FnZShzdGF0ZSwgZmluYWxSZWR1Y2VycywgYWN0aW9uLCB1bmV4cGVjdGVkS2V5Q2FjaGUpO1xuXG4gICAgICBpZiAod2FybmluZ01lc3NhZ2UpIHtcbiAgICAgICAgd2FybmluZyh3YXJuaW5nTWVzc2FnZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIGhhc0NoYW5nZWQgPSBmYWxzZTtcbiAgICB2YXIgbmV4dFN0YXRlID0ge307XG5cbiAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgZmluYWxSZWR1Y2VyS2V5cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgIHZhciBfa2V5ID0gZmluYWxSZWR1Y2VyS2V5c1tfaV07XG4gICAgICB2YXIgcmVkdWNlciA9IGZpbmFsUmVkdWNlcnNbX2tleV07XG4gICAgICB2YXIgcHJldmlvdXNTdGF0ZUZvcktleSA9IHN0YXRlW19rZXldO1xuICAgICAgdmFyIG5leHRTdGF0ZUZvcktleSA9IHJlZHVjZXIocHJldmlvdXNTdGF0ZUZvcktleSwgYWN0aW9uKTtcblxuICAgICAgaWYgKHR5cGVvZiBuZXh0U3RhdGVGb3JLZXkgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSBnZXRVbmRlZmluZWRTdGF0ZUVycm9yTWVzc2FnZShfa2V5LCBhY3Rpb24pO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JNZXNzYWdlKTtcbiAgICAgIH1cblxuICAgICAgbmV4dFN0YXRlW19rZXldID0gbmV4dFN0YXRlRm9yS2V5O1xuICAgICAgaGFzQ2hhbmdlZCA9IGhhc0NoYW5nZWQgfHwgbmV4dFN0YXRlRm9yS2V5ICE9PSBwcmV2aW91c1N0YXRlRm9yS2V5O1xuICAgIH1cblxuICAgIGhhc0NoYW5nZWQgPSBoYXNDaGFuZ2VkIHx8IGZpbmFsUmVkdWNlcktleXMubGVuZ3RoICE9PSBPYmplY3Qua2V5cyhzdGF0ZSkubGVuZ3RoO1xuICAgIHJldHVybiBoYXNDaGFuZ2VkID8gbmV4dFN0YXRlIDogc3RhdGU7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGJpbmRBY3Rpb25DcmVhdG9yKGFjdGlvbkNyZWF0b3IsIGRpc3BhdGNoKSB7XG4gIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRpc3BhdGNoKGFjdGlvbkNyZWF0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKSk7XG4gIH07XG59XG4vKipcbiAqIFR1cm5zIGFuIG9iamVjdCB3aG9zZSB2YWx1ZXMgYXJlIGFjdGlvbiBjcmVhdG9ycywgaW50byBhbiBvYmplY3Qgd2l0aCB0aGVcbiAqIHNhbWUga2V5cywgYnV0IHdpdGggZXZlcnkgZnVuY3Rpb24gd3JhcHBlZCBpbnRvIGEgYGRpc3BhdGNoYCBjYWxsIHNvIHRoZXlcbiAqIG1heSBiZSBpbnZva2VkIGRpcmVjdGx5LiBUaGlzIGlzIGp1c3QgYSBjb252ZW5pZW5jZSBtZXRob2QsIGFzIHlvdSBjYW4gY2FsbFxuICogYHN0b3JlLmRpc3BhdGNoKE15QWN0aW9uQ3JlYXRvcnMuZG9Tb21ldGhpbmcoKSlgIHlvdXJzZWxmIGp1c3QgZmluZS5cbiAqXG4gKiBGb3IgY29udmVuaWVuY2UsIHlvdSBjYW4gYWxzbyBwYXNzIGFuIGFjdGlvbiBjcmVhdG9yIGFzIHRoZSBmaXJzdCBhcmd1bWVudCxcbiAqIGFuZCBnZXQgYSBkaXNwYXRjaCB3cmFwcGVkIGZ1bmN0aW9uIGluIHJldHVybi5cbiAqXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufE9iamVjdH0gYWN0aW9uQ3JlYXRvcnMgQW4gb2JqZWN0IHdob3NlIHZhbHVlcyBhcmUgYWN0aW9uXG4gKiBjcmVhdG9yIGZ1bmN0aW9ucy4gT25lIGhhbmR5IHdheSB0byBvYnRhaW4gaXQgaXMgdG8gdXNlIEVTNiBgaW1wb3J0ICogYXNgXG4gKiBzeW50YXguIFlvdSBtYXkgYWxzbyBwYXNzIGEgc2luZ2xlIGZ1bmN0aW9uLlxuICpcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGRpc3BhdGNoIFRoZSBgZGlzcGF0Y2hgIGZ1bmN0aW9uIGF2YWlsYWJsZSBvbiB5b3VyIFJlZHV4XG4gKiBzdG9yZS5cbiAqXG4gKiBAcmV0dXJucyB7RnVuY3Rpb258T2JqZWN0fSBUaGUgb2JqZWN0IG1pbWlja2luZyB0aGUgb3JpZ2luYWwgb2JqZWN0LCBidXQgd2l0aFxuICogZXZlcnkgYWN0aW9uIGNyZWF0b3Igd3JhcHBlZCBpbnRvIHRoZSBgZGlzcGF0Y2hgIGNhbGwuIElmIHlvdSBwYXNzZWQgYVxuICogZnVuY3Rpb24gYXMgYGFjdGlvbkNyZWF0b3JzYCwgdGhlIHJldHVybiB2YWx1ZSB3aWxsIGFsc28gYmUgYSBzaW5nbGVcbiAqIGZ1bmN0aW9uLlxuICovXG5cblxuZnVuY3Rpb24gYmluZEFjdGlvbkNyZWF0b3JzKGFjdGlvbkNyZWF0b3JzLCBkaXNwYXRjaCkge1xuICBpZiAodHlwZW9mIGFjdGlvbkNyZWF0b3JzID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGJpbmRBY3Rpb25DcmVhdG9yKGFjdGlvbkNyZWF0b3JzLCBkaXNwYXRjaCk7XG4gIH1cblxuICBpZiAodHlwZW9mIGFjdGlvbkNyZWF0b3JzICE9PSAnb2JqZWN0JyB8fCBhY3Rpb25DcmVhdG9ycyA9PT0gbnVsbCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcImJpbmRBY3Rpb25DcmVhdG9ycyBleHBlY3RlZCBhbiBvYmplY3Qgb3IgYSBmdW5jdGlvbiwgaW5zdGVhZCByZWNlaXZlZCBcIiArIChhY3Rpb25DcmVhdG9ycyA9PT0gbnVsbCA/ICdudWxsJyA6IHR5cGVvZiBhY3Rpb25DcmVhdG9ycykgKyBcIi4gXCIgKyBcIkRpZCB5b3Ugd3JpdGUgXFxcImltcG9ydCBBY3Rpb25DcmVhdG9ycyBmcm9tXFxcIiBpbnN0ZWFkIG9mIFxcXCJpbXBvcnQgKiBhcyBBY3Rpb25DcmVhdG9ycyBmcm9tXFxcIj9cIik7XG4gIH1cblxuICB2YXIgYm91bmRBY3Rpb25DcmVhdG9ycyA9IHt9O1xuXG4gIGZvciAodmFyIGtleSBpbiBhY3Rpb25DcmVhdG9ycykge1xuICAgIHZhciBhY3Rpb25DcmVhdG9yID0gYWN0aW9uQ3JlYXRvcnNba2V5XTtcblxuICAgIGlmICh0eXBlb2YgYWN0aW9uQ3JlYXRvciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgYm91bmRBY3Rpb25DcmVhdG9yc1trZXldID0gYmluZEFjdGlvbkNyZWF0b3IoYWN0aW9uQ3JlYXRvciwgZGlzcGF0Y2gpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBib3VuZEFjdGlvbkNyZWF0b3JzO1xufVxuXG5mdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7XG4gIGlmIChrZXkgaW4gb2JqKSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7XG4gICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgd3JpdGFibGU6IHRydWVcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBvYmpba2V5XSA9IHZhbHVlO1xuICB9XG5cbiAgcmV0dXJuIG9iajtcbn1cblxuZnVuY3Rpb24gb3duS2V5cyhvYmplY3QsIGVudW1lcmFibGVPbmx5KSB7XG4gIHZhciBrZXlzID0gT2JqZWN0LmtleXMob2JqZWN0KTtcblxuICBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykge1xuICAgIGtleXMucHVzaC5hcHBseShrZXlzLCBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iamVjdCkpO1xuICB9XG5cbiAgaWYgKGVudW1lcmFibGVPbmx5KSBrZXlzID0ga2V5cy5maWx0ZXIoZnVuY3Rpb24gKHN5bSkge1xuICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlO1xuICB9KTtcbiAgcmV0dXJuIGtleXM7XG59XG5cbmZ1bmN0aW9uIF9vYmplY3RTcHJlYWQyKHRhcmdldCkge1xuICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV0gIT0gbnVsbCA/IGFyZ3VtZW50c1tpXSA6IHt9O1xuXG4gICAgaWYgKGkgJSAyKSB7XG4gICAgICBvd25LZXlzKHNvdXJjZSwgdHJ1ZSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIF9kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgc291cmNlW2tleV0pO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycykge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhzb3VyY2UpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb3duS2V5cyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Ioc291cmNlLCBrZXkpKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0YXJnZXQ7XG59XG5cbi8qKlxuICogQ29tcG9zZXMgc2luZ2xlLWFyZ3VtZW50IGZ1bmN0aW9ucyBmcm9tIHJpZ2h0IHRvIGxlZnQuIFRoZSByaWdodG1vc3RcbiAqIGZ1bmN0aW9uIGNhbiB0YWtlIG11bHRpcGxlIGFyZ3VtZW50cyBhcyBpdCBwcm92aWRlcyB0aGUgc2lnbmF0dXJlIGZvclxuICogdGhlIHJlc3VsdGluZyBjb21wb3NpdGUgZnVuY3Rpb24uXG4gKlxuICogQHBhcmFtIHsuLi5GdW5jdGlvbn0gZnVuY3MgVGhlIGZ1bmN0aW9ucyB0byBjb21wb3NlLlxuICogQHJldHVybnMge0Z1bmN0aW9ufSBBIGZ1bmN0aW9uIG9idGFpbmVkIGJ5IGNvbXBvc2luZyB0aGUgYXJndW1lbnQgZnVuY3Rpb25zXG4gKiBmcm9tIHJpZ2h0IHRvIGxlZnQuIEZvciBleGFtcGxlLCBjb21wb3NlKGYsIGcsIGgpIGlzIGlkZW50aWNhbCB0byBkb2luZ1xuICogKC4uLmFyZ3MpID0+IGYoZyhoKC4uLmFyZ3MpKSkuXG4gKi9cbmZ1bmN0aW9uIGNvbXBvc2UoKSB7XG4gIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBmdW5jcyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICBmdW5jc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgfVxuXG4gIGlmIChmdW5jcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGFyZykge1xuICAgICAgcmV0dXJuIGFyZztcbiAgICB9O1xuICB9XG5cbiAgaWYgKGZ1bmNzLmxlbmd0aCA9PT0gMSkge1xuICAgIHJldHVybiBmdW5jc1swXTtcbiAgfVxuXG4gIHJldHVybiBmdW5jcy5yZWR1Y2UoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGEoYi5hcHBseSh2b2lkIDAsIGFyZ3VtZW50cykpO1xuICAgIH07XG4gIH0pO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBzdG9yZSBlbmhhbmNlciB0aGF0IGFwcGxpZXMgbWlkZGxld2FyZSB0byB0aGUgZGlzcGF0Y2ggbWV0aG9kXG4gKiBvZiB0aGUgUmVkdXggc3RvcmUuIFRoaXMgaXMgaGFuZHkgZm9yIGEgdmFyaWV0eSBvZiB0YXNrcywgc3VjaCBhcyBleHByZXNzaW5nXG4gKiBhc3luY2hyb25vdXMgYWN0aW9ucyBpbiBhIGNvbmNpc2UgbWFubmVyLCBvciBsb2dnaW5nIGV2ZXJ5IGFjdGlvbiBwYXlsb2FkLlxuICpcbiAqIFNlZSBgcmVkdXgtdGh1bmtgIHBhY2thZ2UgYXMgYW4gZXhhbXBsZSBvZiB0aGUgUmVkdXggbWlkZGxld2FyZS5cbiAqXG4gKiBCZWNhdXNlIG1pZGRsZXdhcmUgaXMgcG90ZW50aWFsbHkgYXN5bmNocm9ub3VzLCB0aGlzIHNob3VsZCBiZSB0aGUgZmlyc3RcbiAqIHN0b3JlIGVuaGFuY2VyIGluIHRoZSBjb21wb3NpdGlvbiBjaGFpbi5cbiAqXG4gKiBOb3RlIHRoYXQgZWFjaCBtaWRkbGV3YXJlIHdpbGwgYmUgZ2l2ZW4gdGhlIGBkaXNwYXRjaGAgYW5kIGBnZXRTdGF0ZWAgZnVuY3Rpb25zXG4gKiBhcyBuYW1lZCBhcmd1bWVudHMuXG4gKlxuICogQHBhcmFtIHsuLi5GdW5jdGlvbn0gbWlkZGxld2FyZXMgVGhlIG1pZGRsZXdhcmUgY2hhaW4gdG8gYmUgYXBwbGllZC5cbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0gQSBzdG9yZSBlbmhhbmNlciBhcHBseWluZyB0aGUgbWlkZGxld2FyZS5cbiAqL1xuXG5mdW5jdGlvbiBhcHBseU1pZGRsZXdhcmUoKSB7XG4gIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBtaWRkbGV3YXJlcyA9IG5ldyBBcnJheShfbGVuKSwgX2tleSA9IDA7IF9rZXkgPCBfbGVuOyBfa2V5KyspIHtcbiAgICBtaWRkbGV3YXJlc1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbiAoY3JlYXRlU3RvcmUpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIHN0b3JlID0gY3JlYXRlU3RvcmUuYXBwbHkodm9pZCAwLCBhcmd1bWVudHMpO1xuXG4gICAgICB2YXIgX2Rpc3BhdGNoID0gZnVuY3Rpb24gZGlzcGF0Y2goKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRGlzcGF0Y2hpbmcgd2hpbGUgY29uc3RydWN0aW5nIHlvdXIgbWlkZGxld2FyZSBpcyBub3QgYWxsb3dlZC4gJyArICdPdGhlciBtaWRkbGV3YXJlIHdvdWxkIG5vdCBiZSBhcHBsaWVkIHRvIHRoaXMgZGlzcGF0Y2guJyk7XG4gICAgICB9O1xuXG4gICAgICB2YXIgbWlkZGxld2FyZUFQSSA9IHtcbiAgICAgICAgZ2V0U3RhdGU6IHN0b3JlLmdldFN0YXRlLFxuICAgICAgICBkaXNwYXRjaDogZnVuY3Rpb24gZGlzcGF0Y2goKSB7XG4gICAgICAgICAgcmV0dXJuIF9kaXNwYXRjaC5hcHBseSh2b2lkIDAsIGFyZ3VtZW50cyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB2YXIgY2hhaW4gPSBtaWRkbGV3YXJlcy5tYXAoZnVuY3Rpb24gKG1pZGRsZXdhcmUpIHtcbiAgICAgICAgcmV0dXJuIG1pZGRsZXdhcmUobWlkZGxld2FyZUFQSSk7XG4gICAgICB9KTtcbiAgICAgIF9kaXNwYXRjaCA9IGNvbXBvc2UuYXBwbHkodm9pZCAwLCBjaGFpbikoc3RvcmUuZGlzcGF0Y2gpO1xuICAgICAgcmV0dXJuIF9vYmplY3RTcHJlYWQyKHt9LCBzdG9yZSwge1xuICAgICAgICBkaXNwYXRjaDogX2Rpc3BhdGNoXG4gICAgICB9KTtcbiAgICB9O1xuICB9O1xufVxuXG4vKlxuICogVGhpcyBpcyBhIGR1bW15IGZ1bmN0aW9uIHRvIGNoZWNrIGlmIHRoZSBmdW5jdGlvbiBuYW1lIGhhcyBiZWVuIGFsdGVyZWQgYnkgbWluaWZpY2F0aW9uLlxuICogSWYgdGhlIGZ1bmN0aW9uIGhhcyBiZWVuIG1pbmlmaWVkIGFuZCBOT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nLCB3YXJuIHRoZSB1c2VyLlxuICovXG5cbmZ1bmN0aW9uIGlzQ3J1c2hlZCgpIHt9XG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIHR5cGVvZiBpc0NydXNoZWQubmFtZSA9PT0gJ3N0cmluZycgJiYgaXNDcnVzaGVkLm5hbWUgIT09ICdpc0NydXNoZWQnKSB7XG4gIHdhcm5pbmcoJ1lvdSBhcmUgY3VycmVudGx5IHVzaW5nIG1pbmlmaWVkIGNvZGUgb3V0c2lkZSBvZiBOT0RFX0VOViA9PT0gXCJwcm9kdWN0aW9uXCIuICcgKyAnVGhpcyBtZWFucyB0aGF0IHlvdSBhcmUgcnVubmluZyBhIHNsb3dlciBkZXZlbG9wbWVudCBidWlsZCBvZiBSZWR1eC4gJyArICdZb3UgY2FuIHVzZSBsb29zZS1lbnZpZnkgKGh0dHBzOi8vZ2l0aHViLmNvbS96ZXJ0b3NoL2xvb3NlLWVudmlmeSkgZm9yIGJyb3dzZXJpZnkgJyArICdvciBzZXR0aW5nIG1vZGUgdG8gcHJvZHVjdGlvbiBpbiB3ZWJwYWNrIChodHRwczovL3dlYnBhY2suanMub3JnL2NvbmNlcHRzL21vZGUvKSAnICsgJ3RvIGVuc3VyZSB5b3UgaGF2ZSB0aGUgY29ycmVjdCBjb2RlIGZvciB5b3VyIHByb2R1Y3Rpb24gYnVpbGQuJyk7XG59XG5cbmV4cG9ydCB7IEFjdGlvblR5cGVzIGFzIF9fRE9fTk9UX1VTRV9fQWN0aW9uVHlwZXMsIGFwcGx5TWlkZGxld2FyZSwgYmluZEFjdGlvbkNyZWF0b3JzLCBjb21iaW5lUmVkdWNlcnMsIGNvbXBvc2UsIGNyZWF0ZVN0b3JlIH07XG4iLCIvKiBnbG9iYWwgd2luZG93ICovXG5pbXBvcnQgcG9ueWZpbGwgZnJvbSAnLi9wb255ZmlsbC5qcyc7XG5cbnZhciByb290O1xuXG5pZiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnKSB7XG4gIHJvb3QgPSBzZWxmO1xufSBlbHNlIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICByb290ID0gd2luZG93O1xufSBlbHNlIGlmICh0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJykge1xuICByb290ID0gZ2xvYmFsO1xufSBlbHNlIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICByb290ID0gbW9kdWxlO1xufSBlbHNlIHtcbiAgcm9vdCA9IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKCk7XG59XG5cbnZhciByZXN1bHQgPSBwb255ZmlsbChyb290KTtcbmV4cG9ydCBkZWZhdWx0IHJlc3VsdDtcbiIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHN5bWJvbE9ic2VydmFibGVQb255ZmlsbChyb290KSB7XG5cdHZhciByZXN1bHQ7XG5cdHZhciBTeW1ib2wgPSByb290LlN5bWJvbDtcblxuXHRpZiAodHlwZW9mIFN5bWJvbCA9PT0gJ2Z1bmN0aW9uJykge1xuXHRcdGlmIChTeW1ib2wub2JzZXJ2YWJsZSkge1xuXHRcdFx0cmVzdWx0ID0gU3ltYm9sLm9ic2VydmFibGU7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJlc3VsdCA9IFN5bWJvbCgnb2JzZXJ2YWJsZScpO1xuXHRcdFx0U3ltYm9sLm9ic2VydmFibGUgPSByZXN1bHQ7XG5cdFx0fVxuXHR9IGVsc2Uge1xuXHRcdHJlc3VsdCA9ICdAQG9ic2VydmFibGUnO1xuXHR9XG5cblx0cmV0dXJuIHJlc3VsdDtcbn07XG4iLCJcInVzZSBzdHJpY3RcIjtcblxudmFyIGNvbXBvc2UgPSByZXF1aXJlKCdyZWR1eCcpLmNvbXBvc2U7XG5cbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG5leHBvcnRzLmNvbXBvc2VXaXRoRGV2VG9vbHMgPSAoXG4gIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5fX1JFRFVYX0RFVlRPT0xTX0VYVEVOU0lPTl9DT01QT1NFX18gP1xuICAgIHdpbmRvdy5fX1JFRFVYX0RFVlRPT0xTX0VYVEVOU0lPTl9DT01QT1NFX18gOlxuICAgIGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICBpZiAodHlwZW9mIGFyZ3VtZW50c1swXSA9PT0gJ29iamVjdCcpIHJldHVybiBjb21wb3NlO1xuICAgICAgcmV0dXJuIGNvbXBvc2UuYXBwbHkobnVsbCwgYXJndW1lbnRzKTtcbiAgICB9XG4pO1xuXG5leHBvcnRzLmRldlRvb2xzRW5oYW5jZXIgPSAoXG4gIHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5fX1JFRFVYX0RFVlRPT0xTX0VYVEVOU0lPTl9fID9cbiAgICB3aW5kb3cuX19SRURVWF9ERVZUT09MU19FWFRFTlNJT05fXyA6XG4gICAgZnVuY3Rpb24oKSB7IHJldHVybiBmdW5jdGlvbihub29wKSB7IHJldHVybiBub29wOyB9IH1cbik7XG4iLCJ2YXIgZztcblxuLy8gVGhpcyB3b3JrcyBpbiBub24tc3RyaWN0IG1vZGVcbmcgPSAoZnVuY3Rpb24oKSB7XG5cdHJldHVybiB0aGlzO1xufSkoKTtcblxudHJ5IHtcblx0Ly8gVGhpcyB3b3JrcyBpZiBldmFsIGlzIGFsbG93ZWQgKHNlZSBDU1ApXG5cdGcgPSBnIHx8IG5ldyBGdW5jdGlvbihcInJldHVybiB0aGlzXCIpKCk7XG59IGNhdGNoIChlKSB7XG5cdC8vIFRoaXMgd29ya3MgaWYgdGhlIHdpbmRvdyByZWZlcmVuY2UgaXMgYXZhaWxhYmxlXG5cdGlmICh0eXBlb2Ygd2luZG93ID09PSBcIm9iamVjdFwiKSBnID0gd2luZG93O1xufVxuXG4vLyBnIGNhbiBzdGlsbCBiZSB1bmRlZmluZWQsIGJ1dCBub3RoaW5nIHRvIGRvIGFib3V0IGl0Li4uXG4vLyBXZSByZXR1cm4gdW5kZWZpbmVkLCBpbnN0ZWFkIG9mIG5vdGhpbmcgaGVyZSwgc28gaXQnc1xuLy8gZWFzaWVyIHRvIGhhbmRsZSB0aGlzIGNhc2UuIGlmKCFnbG9iYWwpIHsgLi4ufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGc7XG4iLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG9yaWdpbmFsTW9kdWxlKSB7XG5cdGlmICghb3JpZ2luYWxNb2R1bGUud2VicGFja1BvbHlmaWxsKSB7XG5cdFx0dmFyIG1vZHVsZSA9IE9iamVjdC5jcmVhdGUob3JpZ2luYWxNb2R1bGUpO1xuXHRcdC8vIG1vZHVsZS5wYXJlbnQgPSB1bmRlZmluZWQgYnkgZGVmYXVsdFxuXHRcdGlmICghbW9kdWxlLmNoaWxkcmVuKSBtb2R1bGUuY2hpbGRyZW4gPSBbXTtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobW9kdWxlLCBcImxvYWRlZFwiLCB7XG5cdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuXHRcdFx0Z2V0OiBmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIG1vZHVsZS5sO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtb2R1bGUsIFwiaWRcIiwge1xuXHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcblx0XHRcdGdldDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiBtb2R1bGUuaTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobW9kdWxlLCBcImV4cG9ydHNcIiwge1xuXHRcdFx0ZW51bWVyYWJsZTogdHJ1ZVxuXHRcdH0pO1xuXHRcdG1vZHVsZS53ZWJwYWNrUG9seWZpbGwgPSAxO1xuXHR9XG5cdHJldHVybiBtb2R1bGU7XG59O1xuIiwiY29uc3QgcGxheWVyRW51bXMgPSB7XG4gICAgUExBWUlORzogXCJQTEFZSU5HXCIsXG4gICAgU1RPUFBFRDogXCJTVE9QUEVEXCIsXG4gICAgUEFVU0VEOiBcIlBBVVNFRFwiLFxuICAgIFNFRUtJTkc6IFwiU0VFS0lOR1wiLFxuICAgIFNUQUxMRUQ6IFwiU1RBTExFRFwiLFxuICAgIEVOREVEOiBcIkVOREVEXCJcbn1cblxuY29uc3QgcGxheWVyQWN0aW9ucyA9IHtcbiAgICBUSU1FX1VQREFURTogXCJUSU1FX1VQREFURVwiLFxuICAgIEFCU09MVVRFX1RJTUVfVVBEQVRFOiBcIkFCU09MVVRFX1RJTUVfVVBEQVRFXCIsXG4gICAgU0VUX0JFQUNPTjogXCJTRVRfQkVBQ09OXCIsXG4gICAgQ0xFQVJfQkVBQ09OUzogXCJDTEVBUl9CRUFDT05TXCIsXG4gICAgUExBWV9TVEFURTogXCJQTEFZX1NUQVRFXCIsXG4gICAgUEFVU0VfU1RBVEU6IFwiUEFVU0VfU1RBVEVcIixcbiAgICBTVEFMTEVEX1NUQVRFOiBcIlNUQUxMRURfU1RBVEVcIixcbiAgICBTRUVLSU5HX1NUQVRFOiBcIlNFRUtJTkdfU1RBVEVcIixcbiAgICBTVE9QUEVEX1NUQVRFOiBcIlNUT1BQRURfU1RBVEVcIixcbiAgICBORVhUX0NMSVA6IFwiTkVYVF9DTElQXCIsXG4gICAgUFJFVl9DTElQOiBcIlBSRVZfQ0xJUFwiLFxuICAgIFNXSVRDSF9DTElQOiBcIlNXSVRDSF9DTElQXCIsXG4gICAgQ0xJUExJU1RfVVBEQVRFOiBcIkNMSVBMSVNUX1VQREFURVwiLFxuICAgIENMSVBfRU5ERUQ6IFwiQ0xJUF9FTkRFRFwiXG59XG5cbmNvbnN0IGJlYWNvblR5cGVzID0ge1xuICAgIERFRkFVTFRfSU1QUkVTU0lPTjogXCJkZWZhdWx0SW1wcmVzc2lvblwiLFxuICAgIEZJUlNUX1FVQVJUSUxFOiBcImZpcnN0UXVhcnRpbGVcIixcbiAgICBNSURXQVk6IFwibWlkd2F5XCIsXG4gICAgVEhJUkRfUVVBUlRJTEU6IFwidGhpcmRRdWFydGlsZVwiLFxuICAgIENPTVBMRVRFOiBcImNvbXBsZXRlXCJcbn1cblxuZXhwb3J0IHtcbiAgICBwbGF5ZXJFbnVtcyxcbiAgICBwbGF5ZXJBY3Rpb25zLFxuICAgIGJlYWNvblR5cGVzXG59IiwiaW1wb3J0IHsgcGxheWVyQWN0aW9ucyB9IGZyb20gJy4uL3R5cGVzL3BsYXllckVudW1zJztcblxuY29uc3QgdGltZVVwZGF0ZSA9IChtc0luY3JlbWVudCwgcGxheWVyVGltZSkgPT4gKHtcbiAgICB0eXBlOiBwbGF5ZXJBY3Rpb25zLlRJTUVfVVBEQVRFLFxuICAgIG1zSW5jcmVtZW50LFxuICAgIHBsYXllclRpbWVcbn0pO1xuXG5jb25zdCBzZXRBYm9zbHV0ZVRpbWVsaW5lID0gKG5ld1RpbWUpID0+ICh7XG4gICAgdHlwZTogcGxheWVyQWN0aW9ucy5BQlNPTFVURV9USU1FX1VQREFURSxcbiAgICBwYXlMb2FkOiBuZXdUaW1lXG59KTtcblxuY29uc3Qgc2V0QmVhY29uID0gKGJlYWNvbikgPT4gKHtcbiAgICB0eXBlOiBwbGF5ZXJBY3Rpb25zLlNFVF9CRUFDT04sXG4gICAgcGF5TG9hZDogYmVhY29uXG59KTtcblxuY29uc3QgY2xlYXJCZWFjb25zID0gKCkgPT4gKHtcbiAgICB0eXBlOiBwbGF5ZXJBY3Rpb25zLkNMRUFSX0JFQUNPTlNcbn0pO1xuXG5jb25zdCBwbGF5U3RhdGUgPSAoKSA9PiAoe1xuICAgIHR5cGU6IHBsYXllckFjdGlvbnMuUExBWV9TVEFURVxufSk7XG5cbmNvbnN0IHBhdXNlU3RhdGUgPSAoKSA9PiAoe1xuICAgIHR5cGU6IHBsYXllckFjdGlvbnMuUEFVU0VfU1RBVEVcbn0pO1xuXG5jb25zdCBzdGFsbGVkU3RhdGUgPSAoKSA9PiAoe1xuICAgIHR5cGU6IHBsYXllckFjdGlvbnMuU1RBTExFRF9TVEFURVxufSk7XG5cbmNvbnN0IHN0b3BwZWRTdGF0ZSA9ICgpID0+ICh7XG4gICAgdHlwZTogcGxheWVyQWN0aW9ucy5TVE9QUEVEX1NUQVRFXG59KTtcblxuY29uc3Qgc2Vla2luZ1N0YXRlID0gKCkgPT4gKHtcbiAgICB0eXBlOiBwbGF5ZXJBY3Rpb25zLlNFRUtJTkdfU1RBVEVcbn0pO1xuXG5jb25zdCBuZXh0Q2xpcCA9ICgpID0+ICh7XG4gICAgdHlwZTogcGxheWVyQWN0aW9ucy5ORVhUX0NMSVBcbn0pO1xuXG5jb25zdCBwcmV2Q2xpcCA9ICgpID0+ICh7XG4gICAgdHlwZTogcGxheWVyQWN0aW9ucy5QUkVWX0NMSVBcbn0pO1xuXG5jb25zdCBzd2l0Y2hDbGlwID0gKGNsaXBJbmRleCkgPT4gKHtcbiAgICB0eXBlOiBwbGF5ZXJBY3Rpb25zLlNXSVRDSF9DTElQLFxuICAgIGNsaXBJbmRleFxufSk7XG5cbmNvbnN0IGNsaXBFbmRlZCA9ICgpID0+ICh7XG4gICAgdHlwZTogcGxheWVyQWN0aW9ucy5DTElQX0VOREVEXG59KVxuXG5jb25zdCB1cGRhdGVDbGlwTGlzdCA9IChjbGlwTGlzdCwgY3VycmVudENsaXBJbmRleCkgPT4gKHtcbiAgICB0eXBlOiBwbGF5ZXJBY3Rpb25zLkNMSVBMSVNUX1VQREFURSxcbiAgICBhc3NldENsaXBMaXN0OiB7XG4gICAgICAgIGNsaXBMaXN0LFxuICAgICAgICBjdXJyZW50Q2xpcEluZGV4XG4gICAgfVxufSk7XG5cbmV4cG9ydCB7XG4gICAgdGltZVVwZGF0ZSxcbiAgICBzZXRBYm9zbHV0ZVRpbWVsaW5lLFxuICAgIHNldEJlYWNvbixcbiAgICBjbGVhckJlYWNvbnMsXG4gICAgcGxheVN0YXRlLFxuICAgIHBhdXNlU3RhdGUsXG4gICAgc3RhbGxlZFN0YXRlLFxuICAgIHN0b3BwZWRTdGF0ZSxcbiAgICBzZWVraW5nU3RhdGUsXG4gICAgbmV4dENsaXAsXG4gICAgcHJldkNsaXAsXG4gICAgc3dpdGNoQ2xpcCxcbiAgICB1cGRhdGVDbGlwTGlzdCxcbiAgICBjbGlwRW5kZWRcbn0iLCJjb25zdCBnZXRXaG9sZVBsYXllclRpbWUgPSBmdW5jdGlvbihwbGF5ZXJUaW1lKSB7XG4gICAgcmV0dXJuIE1hdGguY2VpbChwbGF5ZXJUaW1lLzEwMCkgKiAxMDA7XG59XG5cbmNvbnN0IGNvbnZlcnRUb01pbGxpc2Vjb25kcyA9IGZ1bmN0aW9uKHRpbWUpIHtcbiAgICByZXR1cm4gdGltZSAqIDEwMDA7XG59XG5cbmV4cG9ydCB7XG4gICAgZ2V0V2hvbGVQbGF5ZXJUaW1lLFxuICAgIGNvbnZlcnRUb01pbGxpc2Vjb25kc1xufSIsImltcG9ydCB7IGNvbWJpbmVSZWR1Y2VycyB9IGZyb20gJ3JlZHV4JztcbmltcG9ydCB7IHBsYXllckVudW1zLCBwbGF5ZXJBY3Rpb25zIH0gZnJvbSAnLi4vdHlwZXMvcGxheWVyRW51bXMuanMnXG5cbmNvbnN0IHRpbWVsaW5lUmVkdWNlciA9ICh0aW1lT2JqZWN0ID0ge2FwanNUaW1lOiAwLCBwbGF5ZXJUaW1lOiAwLCBiZWFjb25zOiBbXX0sIGFjdGlvbikgPT4ge1xuICAgIHN3aXRjaCAoYWN0aW9uLnR5cGUpIHtcbiAgICAgICAgY2FzZSBwbGF5ZXJBY3Rpb25zLlRJTUVfVVBEQVRFOlxuICAgICAgICAgICAgdGltZU9iamVjdC5hcGpzVGltZSArPSBhY3Rpb24ubXNJbmNyZW1lbnQ7XG4gICAgICAgICAgICB0aW1lT2JqZWN0LnBsYXllclRpbWUgPSBhY3Rpb24ucGxheWVyVGltZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIHBsYXllckFjdGlvbnMuQUJTT0xVVEVfVElNRV9VUERBVEU6XG4gICAgICAgICAgICB0aW1lT2JqZWN0LmFwanNUaW1lID0gYWN0aW9uLnBheUxvYWQ7XG4gICAgICAgICAgICB0aW1lT2JqZWN0LnBsYXllclRpbWUgPSBhY3Rpb24ucGF5TG9hZDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIHBsYXllckFjdGlvbnMuU0VUX0JFQUNPTjpcbiAgICAgICAgICAgIGxldCBpbmRleCA9IHRpbWVPYmplY3QuYmVhY29ucy5maW5kSW5kZXgoYmVhY29uID0+IGJlYWNvbi50eXBlID09PSBhY3Rpb24ucGF5TG9hZC50eXBlICYmIGJlYWNvbi50aW1lSW5kZXggPT09IGFjdGlvbi5wYXlMb2FkLnRpbWVJbmRleCk7XG4gICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgdGltZU9iamVjdC5iZWFjb25zLnNwbGljZShpbmRleCwgYWN0aW9uLnBheUxvYWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aW1lT2JqZWN0LmJlYWNvbnMucHVzaChhY3Rpb24ucGF5TG9hZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBwbGF5ZXJBY3Rpb25zLkNMRUFSX0JFQUNPTlM6XG4gICAgICAgICAgICB0aW1lT2JqZWN0LmJlYWNvbnMgPSBbXTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHJldHVybiB0aW1lT2JqZWN0O1xufVxuXG5jb25zdCBwbGF5ZXJTdGF0ZVJlZHVjZXIgPSAocGxheWVyU3RhdGUgPSBwbGF5ZXJFbnVtcy5TVE9QUEVELCBhY3Rpb24pID0+IHtcbiAgICBzd2l0Y2ggKGFjdGlvbi50eXBlKSB7XG4gICAgICAgIGNhc2UgcGxheWVyQWN0aW9ucy5TVE9QUEVEX1NUQVRFOlxuICAgICAgICAgICAgcGxheWVyU3RhdGUgPSBwbGF5ZXJFbnVtcy5TVE9QUEVEO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgcGxheWVyQWN0aW9ucy5QTEFZX1NUQVRFOlxuICAgICAgICAgICAgcGxheWVyU3RhdGUgPSBwbGF5ZXJFbnVtcy5QTEFZSU5HO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgcGxheWVyQWN0aW9ucy5QQVVTRV9TVEFURTpcbiAgICAgICAgICAgIHBsYXllclN0YXRlID0gcGxheWVyRW51bXMuUEFVU0VEO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgcGxheWVyQWN0aW9ucy5TVEFMTEVEX1NUQVRFOlxuICAgICAgICAgICAgcGxheWVyU3RhdGUgPSBwbGF5ZXJFbnVtcy5TVEFMTEVEO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgcGxheWVyQWN0aW9ucy5TRUVLSU5HX1NUQVRFOlxuICAgICAgICAgICAgcGxheWVyU3RhdGUgPSBwbGF5ZXJFbnVtcy5TRUVLSU5HO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgcGxheWVyQWN0aW9ucy5DTElQX0VOREVEOlxuICAgICAgICAgICAgcGxheWVyU3RhdGUgPSBwbGF5ZXJFbnVtcy5FTkRFRDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4gcGxheWVyU3RhdGVcbn1cblxuY29uc3QgY2xpcExpc3RSZWR1Y2VyID0gKGFzc2V0Q2xpcExpc3QgPSB7Y2xpcExpc3Q6IFtdLCBjdXJyZW50Q2xpcEluZGV4OiAwfSwgYWN0aW9uKSA9PiB7XG4gICAgc3dpdGNoIChhY3Rpb24udHlwZSkge1xuICAgICAgICBjYXNlIHBsYXllckFjdGlvbnMuTkVYVF9DTElQOlxuICAgICAgICAgICAgYXNzZXRDbGlwTGlzdC5jdXJyZW50Q2xpcEluZGV4Kys7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBwbGF5ZXJBY3Rpb25zLlBSRVZfQ0xJUDpcbiAgICAgICAgICAgIGFzc2V0Q2xpcExpc3QuY3VycmVudENsaXBJbmRleC0tO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgcGxheWVyQWN0aW9ucy5TV0lUQ0hfQ0xJUDpcbiAgICAgICAgICAgIGFzc2V0Q2xpcExpc3QuY3VycmVudENsaXBJbmRleCA9IGFjdGlvbi5jbGlwSW5kZXg7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBwbGF5ZXJBY3Rpb25zLkNMSVBMSVNUX1VQREFURTpcbiAgICAgICAgICAgIGFzc2V0Q2xpcExpc3QgPSBhY3Rpb24uYXNzZXRDbGlwTGlzdDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHJldHVybiBhc3NldENsaXBMaXN0O1xufVxuXG5sZXQgYXBKU1JlZHVjZXJzID0gY29tYmluZVJlZHVjZXJzKHtcbiAgICBwbGF5ZXJTdGF0ZVJlZHVjZXIsXG4gICAgY2xpcExpc3RSZWR1Y2VyXG59KVxuXG5leHBvcnQge1xuICAgIHRpbWVsaW5lUmVkdWNlcixcbiAgICBwbGF5ZXJTdGF0ZVJlZHVjZXIsXG4gICAgY2xpcExpc3RSZWR1Y2VyLFxuICAgIGFwSlNSZWR1Y2Vyc1xufSIsImltcG9ydCB7IGNyZWF0ZVN0b3JlIH0gZnJvbSAncmVkdXgnO1xuaW1wb3J0IHsgdGltZWxpbmVSZWR1Y2VyLCBhcEpTUmVkdWNlcnMgfSBmcm9tICcuLi9yZWR1Y2Vycy9pbmRleC5qcyc7XG5pbXBvcnQgeyBjb21wb3NlV2l0aERldlRvb2xzIH0gZnJvbSAncmVkdXgtZGV2dG9vbHMtZXh0ZW5zaW9uJztcblxuY29uc3QgY29tcG9zZUVuaGFuY2VycyA9IGNvbXBvc2VXaXRoRGV2VG9vbHMoeyByZWFsdGltZTogdHJ1ZSB9KTtcbmNvbnN0IHRpbWVsaW5lU3RvcmUgPSBjcmVhdGVTdG9yZSh0aW1lbGluZVJlZHVjZXIsIGNvbXBvc2VFbmhhbmNlcnMoKSk7XG5jb25zdCBhcGpzU3RvcmUgPSBjcmVhdGVTdG9yZShhcEpTUmVkdWNlcnMsIGNvbXBvc2VFbmhhbmNlcnMoKSk7XG5cbmV4cG9ydCB7XG4gICAgdGltZWxpbmVTdG9yZSxcbiAgICBhcGpzU3RvcmVcbn0iLCJpbXBvcnQgeyBiZWFjb25UeXBlcyB9IGZyb20gJy4vcGxheWVyRW51bXMuanMnO1xuXG5cbmV4cG9ydCBkZWZhdWx0IFtcbiAgICBiZWFjb25UeXBlcy5ERUZBVUxUX0lNUFJFU1NJT04sXG4gICAgYmVhY29uVHlwZXMuRklSU1RfUVVBUlRJTEUsXG4gICAgYmVhY29uVHlwZXMuTUlEV0FZLFxuICAgIGJlYWNvblR5cGVzLlRISVJEX1FVQVJUSUxFLFxuICAgIGJlYWNvblR5cGVzLkNPTVBMRVRFXG5dIiwiZXhwb3J0IGRlZmF1bHQgW1xuICAgIHtcbiAgICAgICAgdXJsOiBcImh0dHBzOi8vbWVkaWEudzMub3JnLzIwMTAvMDUvc2ludGVsL3RyYWlsZXIubXA0XCJcbiAgICB9LFxuICAgIHtcbiAgICAgICAgdXJsOiBcImh0dHA6Ly9jb21tb25kYXRhc3RvcmFnZS5nb29nbGVhcGlzLmNvbS9ndHYtdmlkZW9zLWJ1Y2tldC9zYW1wbGUvQmlnQnVja0J1bm55Lm1wNFwiXG4gICAgfSxcbiAgICB7XG4gICAgICAgIHVybDogXCJodHRwOi8vY29tbW9uZGF0YXN0b3JhZ2UuZ29vZ2xlYXBpcy5jb20vZ3R2LXZpZGVvcy1idWNrZXQvc2FtcGxlL0VsZXBoYW50c0RyZWFtLm1wNFwiXG4gICAgfVxuXSIsImltcG9ydCB7IHRpbWVVcGRhdGUsIHBsYXlTdGF0ZSwgcGF1c2VTdGF0ZSwgc3RhbGxlZFN0YXRlLCBzdG9wcGVkU3RhdGUsIHNlZWtpbmdTdGF0ZSwgbmV4dENsaXAsIHVwZGF0ZUNsaXBMaXN0LCBjbGlwRW5kZWQsIHNldEFib3NsdXRlVGltZWxpbmUsIHNldEJlYWNvbiwgY2xlYXJCZWFjb25zIH0gZnJvbSAnLi9hY3Rpb25zL2luZGV4LmpzJztcbmltcG9ydCB7IGdldFdob2xlUGxheWVyVGltZSwgY29udmVydFRvTWlsbGlzZWNvbmRzfSBmcm9tICcuL3V0aWxzLmpzJztcbmltcG9ydCB7IHRpbWVsaW5lU3RvcmUsIGFwanNTdG9yZSB9IGZyb20gJy4vc3RvcmUvaW5kZXguanMnO1xuaW1wb3J0IHsgcGxheWVyRW51bXMsIGJlYWNvblR5cGVzIH0gZnJvbSAnLi90eXBlcy9wbGF5ZXJFbnVtcy5qcyc7XG5pbXBvcnQgYmVhY29ucyBmcm9tICcuL3R5cGVzL2JlYWNvbnMuanMnO1xuaW1wb3J0IENsaXBMaXN0IGZyb20gJy4vdHlwZXMvY2xpcExpc3QuanMnO1xuXG5jb25zdCBpbnRlcnZhbFRpbWUgPSAxMDA7XG5jb25zdCBTVEFMTEVEX1RIUkVTSE9MRCA9IDEwMDAwO1xubGV0IHNhbXBsZVZpZGVvUGxheWVyO1xubGV0IHRpbWVsaW5lSW50ZXJ2YWw7XG5cbiQoZnVuY3Rpb24oKSB7XG4gICAgc2FtcGxlVmlkZW9QbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInNhbXBsZVZpZGVvUGxheWVyXCIpO1xuICAgIHNhbXBsZVZpZGVvUGxheWVyLm9ucGxheSA9ICgpID0+IHtcbiAgICAgICAgcHJvY2Vzc0JlYWNvbnMoKTtcbiAgICAgICAgYXBqc1N0b3JlLmRpc3BhdGNoKHBsYXlTdGF0ZSgpKTtcbiAgICAgICAgaW5pdFRpbWVyKCk7XG4gICAgfTtcbiAgICBzYW1wbGVWaWRlb1BsYXllci5vbnBhdXNlID0gKCkgPT4ge1xuICAgICAgICBhcGpzU3RvcmUuZGlzcGF0Y2gocGF1c2VTdGF0ZSgpKTtcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lbGluZUludGVydmFsKTtcbiAgICB9XG4gICAgc2FtcGxlVmlkZW9QbGF5ZXIub25zdGFsbGVkID0gKCkgPT4ge1xuICAgICAgICBhcGpzU3RvcmUuZGlzcGF0Y2goc3RhbGxlZFN0YXRlKCkpO1xuICAgIH1cbiAgICBzYW1wbGVWaWRlb1BsYXllci5vbnNlZWtpbmcgPSAoKSA9PiB7XG4gICAgICAgIGFwanNTdG9yZS5kaXNwYXRjaChzZWVraW5nU3RhdGUoKSk7XG4gICAgfVxuICAgIHNhbXBsZVZpZGVvUGxheWVyLm9uc2Vla2VkID0gKGV2ZW50KSA9PiB7XG4gICAgICAgIHRpbWVsaW5lU3RvcmUuZGlzcGF0Y2goc2V0QWJvc2x1dGVUaW1lbGluZShnZXRXaG9sZVBsYXllclRpbWUoY29udmVydFRvTWlsbGlzZWNvbmRzKHNhbXBsZVZpZGVvUGxheWVyLmN1cnJlbnRUaW1lKSkpKTtcbiAgICB9O1xuICAgIHNhbXBsZVZpZGVvUGxheWVyLm9uZW5kZWQgPSAoKSA9PiB7XG4gICAgICAgIGFwanNTdG9yZS5kaXNwYXRjaChjbGlwRW5kZWQoKSk7XG4gICAgICAgIGxldCBhcGpzU3RvcmVTdGF0ZSA9IGFwanNTdG9yZS5nZXRTdGF0ZSgpO1xuICAgICAgICBpZiAoYXBqc1N0b3JlU3RhdGUpIHtcbiAgICAgICAgICAgIGxldCBjdXJyZW50Q2xpcEluZGV4ID0gYXBqc1N0b3JlU3RhdGUuY2xpcExpc3RSZWR1Y2VyLmN1cnJlbnRDbGlwSW5kZXggfHwgMDtcbiAgICAgICAgICAgIGxldCBjbGlwTGlzdEZyb21TdG9yZSA9IGFwanNTdG9yZVN0YXRlLmNsaXBMaXN0UmVkdWNlci5jbGlwTGlzdDtcbiAgICAgICAgICAgIGlmIChjdXJyZW50Q2xpcEluZGV4ICsgMSA8IGNsaXBMaXN0RnJvbVN0b3JlLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRpbWVsaW5lU3RvcmUuZGlzcGF0Y2goc2V0QWJvc2x1dGVUaW1lbGluZSgwKSk7XG4gICAgICAgICAgICAgICAgdGltZWxpbmVTdG9yZS5kaXNwYXRjaChjbGVhckJlYWNvbnMoKSk7XG4gICAgICAgICAgICAgICAgYXBqc1N0b3JlLmRpc3BhdGNoKG5leHRDbGlwKCkpO1xuICAgICAgICAgICAgICAgIGxvYWRWaWRlb1NyYyhzYW1wbGVWaWRlb1BsYXllcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhcGpzU3RvcmUuZGlzcGF0Y2godXBkYXRlQ2xpcExpc3QoQ2xpcExpc3QsIDApKTtcbiAgICBsb2FkVmlkZW9TcmMoc2FtcGxlVmlkZW9QbGF5ZXIpO1xuICAgIHRpbWVsaW5lU3RvcmUuc3Vic2NyaWJlKG9uVGltZVVwZGF0ZSk7XG59KTtcblxuZnVuY3Rpb24gbG9hZFZpZGVvU3JjKHNhbXBsZVZpZGVvUGxheWVyKSB7XG4gICAgbGV0IGFwanNTdG9yZVN0YXRlID0gYXBqc1N0b3JlLmdldFN0YXRlKCk7XG4gICAgaWYgKGFwanNTdG9yZVN0YXRlLmNsaXBMaXN0UmVkdWNlcikge1xuICAgICAgICBsZXQgY3VycmVudENsaXBJbmRleCA9IGFwanNTdG9yZVN0YXRlLmNsaXBMaXN0UmVkdWNlci5jdXJyZW50Q2xpcEluZGV4IHx8IDA7XG4gICAgICAgIGxldCBjbGlwTGlzdEZyb21TdG9yZSA9IGFwanNTdG9yZVN0YXRlLmNsaXBMaXN0UmVkdWNlci5jbGlwTGlzdDtcbiAgICAgICAgbGV0IHNvdXJjZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic291cmNlXCIpO1xuICAgICAgICBzb3VyY2VFbGVtZW50LnR5cGUgPSBcInZpZGVvL21wNFwiO1xuICAgICAgICBzb3VyY2VFbGVtZW50LnNyYyA9IGNsaXBMaXN0RnJvbVN0b3JlW2N1cnJlbnRDbGlwSW5kZXhdLnVybDtcbiAgICAgICAgc2FtcGxlVmlkZW9QbGF5ZXIuaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgICAgc2FtcGxlVmlkZW9QbGF5ZXIuYXBwZW5kQ2hpbGQoc291cmNlRWxlbWVudCk7XG4gICAgICAgIGlmIChjdXJyZW50Q2xpcEluZGV4ID4gMCkge1xuICAgICAgICAgICAgc2FtcGxlVmlkZW9QbGF5ZXIubG9hZCgpXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBzYW1wbGVWaWRlb1BsYXllci5wbGF5KCk7XG4gICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gcHJvY2Vzc0JlYWNvbnMoKSB7XG4gICAgbGV0IGFzc2V0RHVyYXRpb24gPSBzYW1wbGVWaWRlb1BsYXllci5kdXJhdGlvbjtcbiAgICBiZWFjb25zLm1hcChiZWFjb25UeXBlID0+IHtcbiAgICAgICAgbGV0IHRpbWVJbmRleCA9IDA7XG4gICAgICAgIHN3aXRjaCAoYmVhY29uVHlwZSkge1xuICAgICAgICAgICAgY2FzZSBiZWFjb25UeXBlcy5ERUZBVUxUX0lNUFJFU1NJT046XG4gICAgICAgICAgICAgICAgdGltZUluZGV4ID0gMDtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgYmVhY29uVHlwZXMuRklSU1RfUVVBUlRJTEU6XG4gICAgICAgICAgICAgICAgdGltZUluZGV4ID0gYXNzZXREdXJhdGlvbiAqIC4yNTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgYmVhY29uVHlwZXMuTUlEV0FZOiBcbiAgICAgICAgICAgICAgICB0aW1lSW5kZXggPSBhc3NldER1cmF0aW9uIC8gMjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgYmVhY29uVHlwZXMuVEhJUkRfUVVBUlRJTEU6XG4gICAgICAgICAgICAgICAgdGltZUluZGV4ID0gYXNzZXREdXJhdGlvbiAqIC43NTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgYmVhY29uVHlwZXMuQ09NUExFVEU6XG4gICAgICAgICAgICAgICAgdGltZUluZGV4ID0gYXNzZXREdXJhdGlvbjtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBiZWFjb24gPSB7XG4gICAgICAgICAgICB0eXBlOiBiZWFjb25UeXBlLFxuICAgICAgICAgICAgdGltZUluZGV4OiBjb252ZXJ0VG9NaWxsaXNlY29uZHModGltZUluZGV4KSxcbiAgICAgICAgICAgIGlzRmlyZWQ6IGZhbHNlXG4gICAgICAgIH1cbiAgICAgICAgdGltZWxpbmVTdG9yZS5kaXNwYXRjaChzZXRCZWFjb24oYmVhY29uKSk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGluaXRUaW1lcigpIHtcbiAgICB0aW1lbGluZUludGVydmFsID0gd2luZG93LnNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgbGV0IHByZXZQbGF5ZXJUaW1lID0gdGltZWxpbmVTdG9yZS5nZXRTdGF0ZSgpLnBsYXllclRpbWU7IFxuICAgICAgICBsZXQgY3VycmVudFBsYXllclRpbWUgPSBzYW1wbGVWaWRlb1BsYXllci5jdXJyZW50VGltZTtcbiAgICAgICAgbGV0IGN1cnJlbnRQbGF5ZXJTdGF0ZSA9IGFwanNTdG9yZS5nZXRTdGF0ZSgpLnBsYXllclN0YXRlO1xuICAgICAgICBpZiAoKGN1cnJlbnRQbGF5ZXJUaW1lIC0gcHJldlBsYXllclRpbWUpID4gU1RBTExFRF9USFJFU0hPTEQgJiYgY3VycmVudFBsYXllclN0YXRlICE9PSBwbGF5ZXJFbnVtcy5TVEFMTEVEKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiU3RhbGwgZGV0ZWN0ZWRcIik7XG4gICAgICAgICAgICBhcGpzU3RvcmUuZGlzcGF0Y2goc3RhbGxlZFN0YXRlKCkpO1xuICAgICAgICB9XG4gICAgICAgIHRpbWVsaW5lU3RvcmUuZGlzcGF0Y2godGltZVVwZGF0ZShpbnRlcnZhbFRpbWUsIGN1cnJlbnRQbGF5ZXJUaW1lKSk7XG4gICAgfSwgaW50ZXJ2YWxUaW1lKTtcbn1cblxuZnVuY3Rpb24gb25UaW1lVXBkYXRlKCkge1xuICAgIGxldCBjdXJyZW50QVBKU1RpbWVNUyA9IHRpbWVsaW5lU3RvcmUuZ2V0U3RhdGUoKS5hcGpzVGltZTtcbiAgICBsZXQgY3VycmVudEFQSlNUaW1lU2Vjb25kcyA9IGN1cnJlbnRBUEpTVGltZU1TIC8gMTAwMDtcbiAgICBsZXQgY3VycmVudFBsYXllclRpbWUgPSB0aW1lbGluZVN0b3JlLmdldFN0YXRlKCkucGxheWVyVGltZTtcblxuICAgIGlmIChjdXJyZW50QVBKU1RpbWVNUyAlIDEwMDAgPT09IDAgJiYgY3VycmVudEFQSlNUaW1lTVMgIT09IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coYDEgc2Vjb25kIGludGVydmFsIGhhcHBlbmVkISBBUEpTVGltZTogJHtjdXJyZW50QVBKU1RpbWVNU30gbXMgUGxheWVyVGltZTogJHtjdXJyZW50UGxheWVyVGltZX0gc2VjYCk7XG4gICAgfVxuXG4gICAgaWYgKGN1cnJlbnRBUEpTVGltZVNlY29uZHMgJSAzMCA9PT0gMCAmJiBjdXJyZW50QVBKU1RpbWVNUyAhPT0gMCkge1xuICAgICAgICBjb25zb2xlLmxvZyhgMzAgc2Vjb25kIGludGVydmFsIGhhcHBlbmVkISBBUEpTVGltZTogJHtjdXJyZW50QVBKU1RpbWVTZWNvbmRzfSBzZWMgUGxheWVyVGltZTogJHtjdXJyZW50UGxheWVyVGltZX0gc2VjYCk7XG4gICAgfVxuXG4gICAgaWYgKGN1cnJlbnRBUEpTVGltZVNlY29uZHMgJSA2MCA9PT0gMCAmJiBjdXJyZW50QVBKU1RpbWVNUyAhPT0gMCkge1xuICAgICAgICBjb25zb2xlLmxvZyhgMSBtaW51dGUgaW50ZXJ2YWwgaGFwcGVuZWQhIEFQSlNUaW1lOiAke2N1cnJlbnRBUEpTVGltZVNlY29uZHN9IHNlYyBQbGF5ZXJUaW1lOiAke2N1cnJlbnRQbGF5ZXJUaW1lfSBzZWNgKTtcbiAgICB9XG5cbiAgICBpZiAoY3VycmVudEFQSlNUaW1lU2Vjb25kcyAlIDMwMCA9PT0gMCAmJiBjdXJyZW50QVBKU1RpbWVNUyAhPT0gMCkge1xuICAgICAgICBjb25zb2xlLmxvZyhgNSBtaW51dGUgaW50ZXJ2YWwgaGFwcGVuZWQhIEFQSlNUaW1lOiAke2N1cnJlbnRBUEpTVGltZVNlY29uZHN9IHNlYyBQbGF5ZXJUaW1lOiAke2N1cnJlbnRQbGF5ZXJUaW1lfSBzZWNgKTtcbiAgICB9XG59Il0sInNvdXJjZVJvb3QiOiIifQ==